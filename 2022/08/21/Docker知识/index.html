<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="perter的技术分享"><meta name="keywords" content="Docker run参数,Docker build java环境,Docker网络,Docker原理,Docker命令,Docker,什么是docker,DockerFile,"><title>Docker知识 | perter blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-MDFK5LR2L9" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MDFK5LR2L9');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '51cd3d8b2f315ceeb62cbeda68c1d672';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Docker知识</h1><a id="logo" href="/.">perter blog</a><p class="description">perter的技术分享</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Docker知识</h1><div class="post-meta">2022-08-21<span> | </span><span class="category"><a href="/categories/Docker/">Docker</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.8k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 18</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F%E6%BC%94%E5%8F%98"><span class="toc-number">1.</span> <span class="toc-text">部署方式演变</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdocker"><span class="toc-number">2.</span> <span class="toc-text">什么是docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E8%B7%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.</span> <span class="toc-text">docker跟虚拟机区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%A5%BD%E5%A4%84%EF%BC%88%E8%8A%82%E7%9C%81%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%97%B6%E9%97%B4%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">docker 好处（节省项目环境部署时间）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%A5%BD%E5%A4%84%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">docker 好处总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mac%E5%AE%89%E8%A3%85docker"><span class="toc-number">3.</span> <span class="toc-text">mac安装docker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker%E5%AE%89%E8%A3%85nginx"><span class="toc-number">4.</span> <span class="toc-text">docker安装nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-nginx%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-number">4.1.</span> <span class="toc-text">运行 nginx的总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-daemon"><span class="toc-number">5.</span> <span class="toc-text">Docker daemon</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E9%95%9C%E5%83%8F%EF%BC%88image%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">docker -镜像（image）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E2%80%93%E5%AE%B9%E5%99%A8-container"><span class="toc-number">5.2.</span> <span class="toc-text">docker–容器(container)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93-images-Repository"><span class="toc-number">5.3.</span> <span class="toc-text">docker 镜像仓库(images Repository)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#build-java%E7%8E%AF%E5%A2%83-dockerfile"><span class="toc-number">6.</span> <span class="toc-text">build java环境(dockerfile)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockfile%E6%8F%8F%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">Dockfile描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E6%8C%87%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">DockerFile 指令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-%E5%91%BD%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">docker 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0docker%E9%95%9C%E5%83%8F%E8%87%B3%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">7.1.</span> <span class="toc-text">上传docker镜像至阿里云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%91%BD%E4%BB%A4%E8%AF%B4%E6%98%8E"><span class="toc-number">7.2.</span> <span class="toc-text">docker命令说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-run-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">7.3.</span> <span class="toc-text">docker run 参数说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-%E9%95%9C%E5%83%8F%E4%B8%8E%E5%AE%B9%E5%99%A8%E8%81%94%E7%B3%BB%E5%92%8C%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8"><span class="toc-number">8.</span> <span class="toc-text">docker 镜像与容器联系和存储驱动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker%E7%BD%91%E7%BB%9C"><span class="toc-number">9.</span> <span class="toc-text">docker网络</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-%E5%8E%9F%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text">docker 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#namespace"><span class="toc-number">10.1.</span> <span class="toc-text">namespace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CGroups"><span class="toc-number">10.2.</span> <span class="toc-text">CGroups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UnionFS"><span class="toc-number">10.3.</span> <span class="toc-text">UnionFS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-%E5%B8%B8%E7%94%A8%E9%95%9C%E5%83%8F"><span class="toc-number">11.</span> <span class="toc-text">docker 常用镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-mysql"><span class="toc-number">11.1.</span> <span class="toc-text">docker mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-redis"><span class="toc-number">11.2.</span> <span class="toc-text">docker redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ubuntu-build-openjdk11%E7%8E%AF%E5%A2%83"><span class="toc-number">11.3.</span> <span class="toc-text">ubuntu build openjdk11环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#alpine-build-openjdk11%E7%8E%AF%E5%A2%83"><span class="toc-number">11.4.</span> <span class="toc-text">alpine build openjdk11环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bdocker%E5%AE%B9%E5%99%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">12.</span> <span class="toc-text">查看docker容器信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-cache%E4%BF%A1%E6%81%AF"><span class="toc-number">13.</span> <span class="toc-text">docker cache信息</span></a></li></ol></div></div><div class="post-content"><h1 id="部署方式演变"><a href="#部署方式演变" class="headerlink" title="部署方式演变"></a>部署方式演变</h1><p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-0.png" alt="部署方式演变"></p>
<ul>
<li><p>传统部署时代<br>早期，企业直接将应用程序部署在物理机上。由于物理机上不能为应用程序定义资源使用边界，我们也就很难合理地分配计算资源。例如：如果多个应用程序运行在同一台物理机上，可能发生这样的情况：其中的一个应用程序消耗了大多数的计算资源，导致其他应用程序不能正常运行。应对此问题的一种解决办法是，将每一个应用程序运行在不同的物理机上。然而，这种做法无法大规模实施，因为资源利用率很低，且企业维护更多物理机的成本昂贵。<br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-1.png" alt="传统部署时代"></p>
</li>
<li><p>虚拟化部署时代</p>
<ul>
<li>针对上述问题，虚拟化技术应运而生。用户可以在单台物理机的CPU上运行多个虚拟机（Virtual Machine）。</li>
<li>虚拟化技术使得应用程序被虚拟机相互分隔开，限制了应用程序之间的非法访问，进而提供了一定程度的安全性。</li>
<li>虚拟化技术提高了物理机的资源利用率，可以更容易地安装或更新应用程序，降低了硬件成本，因此可以更好地规模化实施。</li>
<li>每一个虚拟机可以认为是被虚拟化的物理机之上的一台完整的机器，其中运行了一台机器的所有组件，包括虚拟机自身的操作系统。<br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-2.png" alt="虚拟化部署时代"></li>
</ul>
<p>  </p>
</li>
<li><p>容器化部署时代<br>容器与虚拟机类似，但是降低了隔离层级，共享了操作系统。因此，容器可以认为是轻量级的。<br>与虚拟机相似，每个容器拥有自己的文件系统、CPU、内存、进程空间等<br>运行应用程序所需要的资源都被容器包装，并和底层基础架构解耦<br>容器化的应用程序可以跨云服务商、跨Linux操作系统发行版进行部署</p>
</li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-3.png" alt="容器化部署时代"></p>
<h1 id="什么是docker"><a href="#什么是docker" class="headerlink" title="什么是docker"></a>什么是docker</h1><ul>
<li><p>Docker 是一个开源的应用容器引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在本地编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare metal、OpenStack 集群和其他的基础应用平台。</p>
</li>
<li><p>简单的理解，Docker类似于集装箱，各式各样的货物，经过集装箱的标准化进行托管，而集装箱和集装箱之间没有影响。也就是说，Docker平台就是一个软件集装箱化平台，这就意味着我们自己可以构建应用程序，将其依赖关系一起打包到一个容器中，然后这容器就很容易运送到其他的机器上进行运行，而且非常易于装载、复制、移除，非常适合软件弹性架构。</p>
</li>
</ul>
<h2 id="docker跟虚拟机区别"><a href="#docker跟虚拟机区别" class="headerlink" title="docker跟虚拟机区别"></a>docker跟虚拟机区别</h2><p>Docker可以让一个应用在任何操作系统中非常方便的运行。而以前我们接触的虚拟机，也能在一个操作系统中，运行另外一个操作系统，保护系统中的任何应用。</p>
<p>两者有什么差异呢？</p>
<p>虚拟机（virtual machine）是在操作系统中模拟硬件设备，然后运行另一个操作系统，比如在 Windows 系统里面运行 Ubuntu 系统，这样就可以运行任意的Ubuntu应用了。</p>
<p>Docker仅仅是封装函数库，并没有模拟完整的操作系统，如图：</p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-9.png" alt="docker跟虚拟机区别1"><br>由于容器所需的资源要少得多（例如，它们不需要一个完整的 OS），所以它们易于部署且可快速启动。这使你能够具有更高的密度，也就是说，这允许你在同一硬件单元上运行更多服务，从而降低了成本</p>
<p>对比<br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-4.png" alt="docker跟虚拟机区别2"><br>  <br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-8.png" alt="docker跟虚拟机区别3">
  </p>
<h2 id="docker-好处（节省项目环境部署时间）"><a href="#docker-好处（节省项目环境部署时间）" class="headerlink" title="docker 好处（节省项目环境部署时间）"></a>docker 好处（节省项目环境部署时间）</h2><ul>
<li><p>场景1：单项目打包</p>
<ul>
<li><p>每次部署项目到测试、生产等环境，都要部署一大堆依赖的软件、工具，而且部署期间出现问题几率很大，不经意就花费了很长时间。</p>
</li>
<li><p>Docker主要理念就是环境打包部署，可在任意Docker Engine运行。前期我们只需要将每个项目环境打包到镜像，push到镜像仓库，当有需要部署这个项目时，直接pull镜像启动容器，这个项目就可以访问了！一次构建多次部署，一劳永逸。</p>
</li>
</ul>
</li>
<li><p>场景二：环境一致性</p>
<ul>
<li><p>开发工程师在Windows系统上开发项目，测试、生产环境操作系统都是Linux系统，这就产生了环境不一致的情况：项目在开发电脑本地运行没问题，到了测试或生产环境就运行不起来，解决这问题最好方式就是这三处环境保持一致。软件版本、操作系统、物理机、云主机……试想下，能做到吗？</p>
</li>
<li><p>Docker将项目环境打包成镜像，可以在任何Docker Engine上浪。此时Docker就是我们这些项目的基石，Docker可移植性，保持运行状态一致性，可想而知，是否更容易解决问题呢？</p>
</li>
</ul>
</li>
<li><p>场景三：持续集成</p>
<p>  *一个项目版本快速迭代的测试场景，需要一个合理的CI（持续集成）&#x2F;CD（持续部署）环境支撑。CI&#x2F;CD是一个周期性自动化项目测试流程，包括构建、部署、测试、发布等工作，很少需要人工干预。</p>
</li>
</ul>
<p>项目测试流程大致如下图：</p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-11.png" alt="图片/2022/08/21/Docker知/pasted-11.png"></p>
<p>Docker结合Jenkins构建持续集成环境大致如下图：</p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-12.png" alt="图片/2022/08/21/Docker知/pasted-12.png"><br>Docker在上面这个图的作用是项目镜像构建和快速部署，打通测试环境与生产环境，高度保持多个环境之间一致性。</p>
<ul>
<li>场景四：微服务<ul>
<li><p>微服务是近几年来IT圈内谈论比较多的一个名词，意义也很简单：尽可能细粒度拆分业务程序架构，由多个独立服务组成业务系统。</p>
</li>
<li><p>Docker的容器设计原则：一个容器一个服务，容器之间相互隔离，不妨试想一下，如果容器作为这些独立服务的部署单元，是不是有点恰到好处呢？</p>
</li>
</ul>
</li>
<li>场景五：弹性伸缩<ul>
<li><p>说到弹性伸缩，通常是集群模式下存在。像AWS AutoScaling，可以自定义资源阈值，SLB自动添加EC2云主机，应对业务访问量突发情况。</p>
</li>
<li><p>当适用Docker技术以后，这种弹性伸缩的单元就是云主机之上的容器了。</p>
</li>
<li><p>容器集群化管理已经有成熟的解决方案，比如：官方的Swarm，谷歌的K8S</p>
</li>
<li><p>由于Docker容器快速启动特性，可以很快速的启动几十个、上百个容器来提供更多并发和资源利用率（如果宿主机资源不够，还需要加主机到集群中）。</p>
</li>
</ul>
</li>
</ul>
<h2 id="docker-好处总结"><a href="#docker-好处总结" class="headerlink" title="docker 好处总结"></a>docker 好处总结</h2><p>根据上述应用场景总结下Docker特点：开箱即用，快速部署，可移植性强，环境隔离等。<br>简化部署流程，提高生产力！</p>
<h1 id="mac安装docker"><a href="#mac安装docker" class="headerlink" title="mac安装docker"></a>mac安装docker</h1><p><a href="https://petertanblog.github.io/2022/08/21/Mac%E6%8A%80%E5%B7%A7/#%E5%AE%89%E8%A3%85Docker">mac安装docker</a></p>
<h1 id="docker安装nginx"><a href="#docker安装nginx" class="headerlink" title="docker安装nginx"></a>docker安装nginx</h1><ul>
<li><p>run nginx</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -d --name nginx  -p <span class="number">8081</span>:<span class="number">80</span> ngin</span><br></pre></td></tr></table></figure></li>
<li><p>访问Nginx<br><a target="_blank" rel="noopener" href="http://localhost:8081/">http://localhost:8081</a><br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-13.png" alt="访问Nginx"></p>
</li>
<li><p>查看log</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker logs -f nginx</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-14.png" alt="查看log"></p>
</li>
<li><p>进入容器</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -<span class="keyword">it</span> nginx bash</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-15.png" alt="进入容器"></p>
</li>
<li><p>停止容器</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop nginx</span><br></pre></td></tr></table></figure></li>
<li><p>查看容器情况</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-16.png" alt="查看容器情况"></p>
<ul>
<li>清理停止容器<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">container</span> prune</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-17.png" alt="清理停止容器"></p>
<ul>
<li>新建目录 在某个目录新建html<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir html</span><br></pre></td></tr></table></figure></li>
<li>进入目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> html</span><br></pre></td></tr></table></figure></li>
<li>创建页面<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;welcome to nginx&#x27;</span> &gt; <span class="built_in">index</span>.html</span><br></pre></td></tr></table></figure></li>
<li>运行命令<br>把命令行xxx换成html目录下<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name some-nginx -v <span class="regexp">/xxx/</span>html:<span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html -p <span class="number">8081</span>:<span class="number">80</span> -d nginx</span><br></pre></td></tr></table></figure></li>
<li>重新访问<a target="_blank" rel="noopener" href="http://localhost:8081/">http://localhost:8081</a><br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-18.png" alt="重新访问"></li>
</ul>
<h2 id="运行-nginx的总结"><a href="#运行-nginx的总结" class="headerlink" title="运行 nginx的总结"></a>运行 nginx的总结</h2><p>docker核心：镜像，容器，仓库</p>
<p>docker 常用命令：</p>
<ul>
<li>run— 运行一个镜像</li>
<li>images –查看本地镜像库</li>
<li>ps -a –查看本地所有容器状态</li>
<li>container prune –清理不正常容器</li>
<li>stop –停止容器</li>
<li>logs -f 容器id或容器名称 –查看日志</li>
<li>exec -it 容器id或容器名称  sh –进入容器</li>
<li>docker info–查看docker 信息</li>
</ul>
<h1 id="Docker-daemon"><a href="#Docker-daemon" class="headerlink" title="Docker daemon"></a>Docker daemon</h1><ul>
<li>docker采用C&#x2F;S架构，Dcoker daemon作为服务端接受来自客户端请求，并处理这些请求，比如创建容器、管理镜像。</li>
<li>为了兼容OCI标准，Docker1.1之后也做了架构调整，Docker容器运行已经不是简单的通过Docker daemon来启动，而是集成了containerd、runc等多个组件。</li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-19.png" alt="Docker daemon"></p>
<ul>
<li>Containerd：是一个简单的守护进程，管理shim，向Docker Engine提供接口。使用UnixSocket通信，协议是grpc。</li>
<li>Shim：管理一个容器</li>
<li>runC：运行一个容器。是基于OCI标准的一个容器技术实现，是一个可以直接创建和运行容器的工具。runc直接与容器所依赖的cgroups&#x2F;kernel等进行交互，负责容器所需环境。</li>
</ul>
<h2 id="docker-镜像（image）"><a href="#docker-镜像（image）" class="headerlink" title="docker -镜像（image）"></a>docker -镜像（image）</h2><ul>
<li>Docker的流行，很大因素是取决于有数十万计免费的应用镜像，使得用户或者开发者很容器找到可用的镜像。</li>
<li>镜像不是一个单一的文件，而是有多层构成。可以理解为镜像是创建容器的模板，一个镜像可以创建N个容器。镜像通常封装了一个应用的基础环境。</li>
<li>Docker 镜像（Image），就相当于是一个 root 文件系统（不包含linux内核而有精简linux操作系统）</li>
</ul>
<h2 id="docker–容器-container"><a href="#docker–容器-container" class="headerlink" title="docker–容器(container)"></a>docker–容器(container)</h2><ul>
<li><p>Container中文意思是集装箱，很多人叫容器，其实延续了原理的Linux container，不管叫哪个，含义是一样的。我觉得叫容器比较合适。容器本质上是Linux系统上的一个进程，这个父进程可能会有多个子进程组成，这个一组进程受资源限制，与其他组进程之间隔离。这种运行时的状态成为容器。</p>
</li>
<li><p>镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
</li>
</ul>
<h2 id="docker-镜像仓库-images-Repository"><a href="#docker-镜像仓库-images-Repository" class="headerlink" title="docker 镜像仓库(images Repository)"></a>docker 镜像仓库(images Repository)</h2><ul>
<li>容器是通过镜像创建的，大量的镜像需要找一个地方存放，这就需要Registry（注册中心）。</li>
<li>企业通常自建私有仓库，也可以使用公共仓库，例如：<ul>
<li>Docker Hub 地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></li>
<li>Docker官方提供的公共托管Registry，上面有很多现成的镜像，Docker CLI默认就是从这个仓库下载的。</li>
<li>VMware Harbor 地址：<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a> VMware Harbor（简称Harbor）项目是由VMware中国研发团队开发的开源容器镜像仓库系统</li>
</ul>
</li>
</ul>
<h1 id="build-java环境-dockerfile"><a href="#build-java环境-dockerfile" class="headerlink" title="build java环境(dockerfile)"></a>build java环境(dockerfile)</h1><p>我们要运行一个spring boot web项目，我们就需要安装java，配置环境变量等等<br>现在我使用DockerFile  创建有java环境镜像</p>
<ul>
<li>设置<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云镜像加速</a><br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-35.png" alt="阿里云镜像加速"></li>
<li>centos Dockerfile内容<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM centos </span><br><span class="line">LABEL Author=<span class="string">&quot;ywtana&lt;xx@qq.com&gt;&quot;</span> </span><br><span class="line">RUN sed -i -e <span class="string">&quot;s|mirrorlist=|#mirrorlist=|g&quot;</span> /etc/yum.repos.d/CentOS-* &amp;&amp; \</span><br><span class="line">    sed -i -e <span class="string">&quot;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&quot;</span> /etc/yum.repos.d/CentOS-* &amp;&amp; \ </span><br><span class="line">    yum -y update &amp;&amp; \ </span><br><span class="line">    yum install -y java-11-openjdk tzdata &amp;&amp; \</span><br><span class="line">    yum clean packages &amp;&amp; \</span><br><span class="line">    <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="line">    <span class="built_in">echo</span> Asia/Shanghai &gt; /etc/timezone &amp;&amp; \</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/* /var/cache/*</span><br><span class="line">RUN groupadd -r <span class="built_in">test</span> &amp;&amp; \</span><br><span class="line">    useradd -g <span class="built_in">test</span>  -r <span class="built_in">test</span> &amp;&amp; \</span><br><span class="line">    <span class="built_in">mkdir</span> /test  &amp;&amp; \</span><br><span class="line">    <span class="built_in">chown</span> -R <span class="built_in">test</span>:<span class="built_in">test</span>  /test</span><br><span class="line">USER <span class="built_in">test</span></span><br><span class="line">WORKDIR /test</span><br><span class="line">RUN <span class="built_in">ls</span> -al /</span><br><span class="line"></span><br></pre></td></tr></table></figure>
build命令<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t openjdk11_centos .</span><br></pre></td></tr></table></figure>
build成功后<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker images</span></span><br></pre></td></tr></table></figure>
运行 test用户登录<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -u <span class="built_in">test</span>:<span class="built_in">test</span> -itd --name openjdk openjdk11_centos</span></span><br></pre></td></tr></table></figure>
进入容器：<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -<span class="keyword">it</span> openjdk sh</span><br></pre></td></tr></table></figure>
进入容器后输入<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java <span class="built_in">version</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-37.png" alt="java version"></p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-38.png" alt="test目录"></p>
<h2 id="Dockfile描述"><a href="#Dockfile描述" class="headerlink" title="Dockfile描述"></a>Dockfile描述</h2><p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-20.png" alt="Dockfile描述"></p>
<h2 id="DockerFile-指令"><a href="#DockerFile-指令" class="headerlink" title="DockerFile 指令"></a>DockerFile 指令</h2><p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-21.png" alt="DockerFile 指令1"><br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-22.png" alt="DockerFile 指令2"></p>
<h1 id="docker-命令"><a href="#docker-命令" class="headerlink" title="docker 命令"></a>docker 命令</h1><h2 id="上传docker镜像至阿里云"><a href="#上传docker镜像至阿里云" class="headerlink" title="上传docker镜像至阿里云"></a>上传docker镜像至阿里云</h2><ul>
<li>点击<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instance/namespaces">链接</a>进行阿里云镜像命名空间<br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-32.png" alt="创建命名空间"></li>
<li>设置<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instance/credentials">访问密码</a></li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-33.png" alt="访问密码"></p>
<ul>
<li>打开终端登录阿里云Docker Registry<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker login <span class="attr">--username</span>=<span class="number">3586</span>*****@<span class="number">163</span><span class="selector-class">.com</span> registry<span class="selector-class">.cn-hangzhou</span><span class="selector-class">.aliyuncs</span>.com</span><br></pre></td></tr></table></figure></li>
<li>docker tag<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">tag</span> <span class="title">nginx</span>  registry.cn-hangzhou.aliyuncs.com/test_peter/nginx:latest</span><br></pre></td></tr></table></figure></li>
<li>docker push<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">push</span> registry.cn-hangzhou.aliyuncs.com<span class="regexp">/test_peter/</span>nginx:latest</span><br></pre></td></tr></table></figure></li>
<li>docker pull<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com<span class="regexp">/test_peter/</span>nginx:latest</span><br></pre></td></tr></table></figure>
<img src="/2022/08/21/Docker%E7%9F%A5/pasted-23.png" alt="docker 命令"></li>
</ul>
<h2 id="docker命令说明"><a href="#docker命令说明" class="headerlink" title="docker命令说明"></a>docker命令说明</h2><p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-24.png" alt="docker 命令1"></p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-25.png" alt="docker 命令2"></p>
<h2 id="docker-run-参数说明"><a href="#docker-run-参数说明" class="headerlink" title="docker run 参数说明"></a>docker run 参数说明</h2><p>语法：docker run [OPTIONS] IMAGE [COMMAND] [ARG…]</p>
<ul>
<li>-d: 后台运行容器，并返回容器ID；</li>
<li>-i: 以交互模式运行容器，通常与 -t 同时使用；</li>
<li>-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</li>
<li>-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</li>
<li>–name&#x3D;”nginx-lb”: 为容器指定一个名称；</li>
<li>–dns 8.8.8.8: 指定容器使用的DNS服务器，默认和宿主一致；</li>
<li>-h “mars”: 指定容器的hostname；</li>
<li>-e username&#x3D;”ritchie”: 设置环境变量；</li>
<li>–env-file&#x3D;[]: 从指定文件读入环境变量；</li>
<li>–cpuset&#x3D;”0-2” or –cpuset&#x3D;”0,1,2”: 绑定容器到指定CPU运行；</li>
<li>-m :设置容器使用内存最大值；</li>
<li>–net&#x3D;”bridge”: 指定容器的网络连接类型，支持 bridge&#x2F;host&#x2F;none&#x2F;container: 四种类型；</li>
<li>–volume , -v: 绑定一个卷</li>
</ul>
<h1 id="docker-镜像与容器联系和存储驱动"><a href="#docker-镜像与容器联系和存储驱动" class="headerlink" title="docker 镜像与容器联系和存储驱动"></a>docker 镜像与容器联系和存储驱动</h1><ul>
<li>Docker镜像是由多个只读层添加而成，启动容器时，Docker加载值读镜像层并在镜像栈顶部添加一个读写层。</li>
<li>如果运行中的容器修改了现有的一个已经存在的文件，那么该文件将会在读写层下面的只读层复制到读写层，该文件的只读版本仍然存在，只是已经被读写曾中该文件的副本所隐层，这就是我们所说的写时复制，Elasticsearch也是用了写时复制。和这个略有不同。</li>
<li>默认情况下，容器不使用任何 volume，此时，容器的数据被保存在容器之内，它只在容器的生命周期内存在，关闭并重启容器，其数据不会受到影响，但是删除Docker容器，数据将会全部丢失。当然，也可以使用 docker commit 命令将它持久化为一个新的镜像</li>
<li>Docker的数据持久化即使数据不随着container的结束而结束，数据存在于host机器上——要么存在于host的某个指定目录中（使用bind mount），要么使用docker自己管理的volume（&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes下）</li>
<li>docker run 指定 -v参数</li>
<li>bind mount例如：<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name some-nginx -v <span class="regexp">/root/</span>html:<span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html -p <span class="number">8081</span>:<span class="number">80</span> -d nginx</span><br></pre></td></tr></table></figure></li>
<li>使用docker volume create my-volume-2 后<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name some-nginx -v my-volume<span class="number">-2</span><span class="symbol">:/usr/share/nginx/html</span> -p <span class="number">8081</span><span class="symbol">:</span><span class="number">80</span> -d nginx</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="docker网络"><a href="#docker网络" class="headerlink" title="docker网络"></a>docker网络</h1><ul>
<li><p>Docker自身的4种网络工作方式，和一些自定义网络模式<br>安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host</p>
<ul>
<li>host：容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。</li>
<li>Container：创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围。<br>None：该模式关闭了容器的网络功能。</li>
<li>Bridge：此模式会为每一个容器分配、设置IP等，并将容器连接到一个docker0虚拟网桥，通过docker0网桥以及Iptables nat表配置与宿主机通信。</li>
</ul>
</li>
<li><p>使用docker network ls 命令列出这些网络</p>
</li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-26.png" alt="docker network ls"></p>
<ul>
<li>run创建Docker容器时<ul>
<li>host模式：使用 –net&#x3D;host 指定。</li>
<li>none模式：使用 –net&#x3D;none 指定。</li>
<li>bridge模式：使用 –net&#x3D;bridge 指定，默认设置。</li>
<li>container模式：使用 –net&#x3D;container:NAME_or_ID 指定。</li>
</ul>
</li>
</ul>
<h1 id="docker-原理"><a href="#docker-原理" class="headerlink" title="docker 原理"></a>docker 原理</h1><p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-27.png" alt="docker 原理"></p>
<ul>
<li><p>命名空间（namespaces）是 Linux 为我们提供的用于分离进程树、网络接口、挂载点以及进程间通信等资源的方法。</p>
</li>
<li><p>CGroups:让系统中所运行任务(进程)的用户定义组分配资源—比如CPU时间、系统内存、网络带宽</p>
</li>
<li><p>UnionFS:把文件系统上多个目录(分支)内容联合挂载到同一个目录下</p>
</li>
</ul>
<h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><p>命名空间（namespaces）是 Linux 为我们提供的用于分离进程树、网络接口、挂载点以及进程间通信等资源的方法。在日常使用 Linux 或者 macOS 时，我们并没有运行多个完全分离的服务器的需要，但是如果我们在服务器上启动了多个服务，这些服务其实会相互影响的，每一个服务都能看到其他服务的进程，也可以访问宿主机器上的任意文件，这是很多时候我们都不愿意看到的，我们更希望运行在同一台机器上的不同服务能做到完全隔离，就像运行在多台不同的机器上一样。</p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-28.png" alt="namespace"></p>
<h2 id="CGroups"><a href="#CGroups" class="headerlink" title="CGroups"></a>CGroups</h2><p>我们通过 Linux 的命名空间为新创建的进程隔离了文件系统、网络并与宿主机器之间的进程相互隔离，但是命名空间并不能够为我们提供物理资源上的隔离，比如 CPU 或者内存，如果在同一台机器上运行了多个对彼此以及宿主机器一无所知的『容器』，这些容器却共同占用了宿主机器的物理资源。</p>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-29.png" alt="CGroups"></p>
<h2 id="UnionFS"><a href="#UnionFS" class="headerlink" title="UnionFS"></a>UnionFS</h2><p>Linux 的命名空间和控制组分别解决了不同资源隔离的问题，前者解决了进程、网络以及文件系统的隔离，后者实现了 CPU、内存等资源的隔离，但是在 Docker 中还有另一个非常重要的问题需要解决 - 也就是镜像。<br><img src="/2022/08/21/Docker%E7%9F%A5/pasted-31.png" alt="UnionFS"></p>
<h1 id="docker-常用镜像"><a href="#docker-常用镜像" class="headerlink" title="docker 常用镜像"></a>docker 常用镜像</h1><h2 id="docker-mysql"><a href="#docker-mysql" class="headerlink" title="docker mysql"></a>docker mysql</h2><ul>
<li>运行mysql 并映射本地数据文件夹 ，映射容器服务的 3306 端口到宿主机的 3306 端口。外部可以直接通过宿主机ip:3306 访问到  的服务；–restart&#x3D;always参数能够使我们在重启docker时,自动启动相关容器<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql --restart=always -p <span class="number">3306</span>:<span class="number">3306</span> -v <span class="regexp">/Users/</span>tanyanwen<span class="regexp">/Downloads/</span>html<span class="regexp">/mysql:/</span>var<span class="regexp">/lib/my</span>sql -e MYSQL_ROOT_PASSWORD=<span class="number">123456</span> -d mysql:<span class="number">5.7</span></span><br></pre></td></tr></table></figure></li>
<li>命令进入mysql容器 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql <span class="regexp">/bin/</span>bash</span><br></pre></td></tr></table></figure></li>
<li>输入mysql命令 登录mysql<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>
<img src="/2022/08/21/Docker%E7%9F%A5/pasted-36.png" alt="mysql命令"></li>
</ul>
<h2 id="docker-redis"><a href="#docker-redis" class="headerlink" title="docker redis"></a>docker redis</h2><ul>
<li>运行redis 镜像 并映射容器服务的 6379 端口到宿主机的 6379 端口。外部可以直接通过宿主机ip:6379 访问到 Redis 的服务；–restart&#x3D;always参数能够使我们在重启docker时,自动启动相关容器<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -itd <span class="attribute">--restart</span>=always --name redis -p 6379:6379 redis</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ubuntu-build-openjdk11环境"><a href="#ubuntu-build-openjdk11环境" class="headerlink" title="ubuntu build openjdk11环境"></a>ubuntu build openjdk11环境</h2><ul>
<li>Dockfile<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu </span><br><span class="line">LABEL Author=<span class="string">&quot;peter&lt;xx@qq.com&gt;&quot;</span> </span><br><span class="line">RUN apt update -y &amp;&amp; \  </span><br><span class="line"> apt upgrade -y &amp;&amp; \</span><br><span class="line"> apt install  -y openjdk-11-jre-headless tzdata &amp;&amp; \</span><br><span class="line"> <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="line"> <span class="built_in">echo</span> Asia/Shanghai &gt; /etc/timezone &amp;&amp; \</span><br><span class="line"> <span class="built_in">rm</span> -rf /tmp/* /var/cache/*</span><br><span class="line"> RUN groupadd -r  <span class="built_in">test</span> &amp;&amp; \</span><br><span class="line">    useradd -g <span class="built_in">test</span> -r <span class="built_in">test</span> &amp;&amp; \</span><br><span class="line">    <span class="built_in">mkdir</span> /test  &amp;&amp; \</span><br><span class="line">    <span class="built_in">chown</span> -R <span class="built_in">test</span>:<span class="built_in">test</span>  /test</span><br><span class="line">USER <span class="built_in">test</span></span><br><span class="line">WORKDIR /test</span><br><span class="line">RUN <span class="built_in">ls</span> -al /</span><br></pre></td></tr></table></figure></li>
<li>执行build命令<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t openjdk11_ubuntu .</span><br></pre></td></tr></table></figure></li>
<li>运行<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -u test:test -<span class="keyword">it</span> <span class="comment">--name openjdk openjdk11_ubuntu</span></span><br></pre></td></tr></table></figure></li>
<li>查看java<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure>
<img src="/2022/08/21/Docker%E7%9F%A5/pasted-41.png" alt="java -version"></li>
</ul>
<h2 id="alpine-build-openjdk11环境"><a href="#alpine-build-openjdk11环境" class="headerlink" title="alpine build openjdk11环境"></a>alpine build openjdk11环境</h2><ul>
<li>Dockfile<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine </span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;peter&lt;xx@qq.com&gt;&quot;</span> </span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apk/repositories &amp;&amp; \</span></span><br><span class="line"><span class="language-bash"> apk update &amp;&amp; \  </span></span><br><span class="line"> apk upgrade &amp;&amp; \</span><br><span class="line"> apk <span class="keyword">add</span><span class="language-bash"> openjdk11 tzdata &amp;&amp; \</span></span><br><span class="line"><span class="language-bash"> <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span></span><br><span class="line"><span class="language-bash"> <span class="built_in">echo</span> Asia/Shanghai &gt; /etc/timezone &amp;&amp; \</span></span><br><span class="line"><span class="language-bash"> <span class="built_in">rm</span> -rf /tmp/* /var/cache/apk/*</span></span><br><span class="line"> <span class="keyword">RUN</span><span class="language-bash"> addgroup <span class="built_in">test</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    adduser -G <span class="built_in">test</span>  <span class="built_in">test</span> -D &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mkdir</span> /test  &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> -R <span class="built_in">test</span>:<span class="built_in">test</span>  /test</span></span><br><span class="line"><span class="keyword">USER</span> test</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /test</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ls</span> -al /</span></span><br></pre></td></tr></table></figure></li>
<li>执行build命令<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker build -t openjdk11_alpine .</span><br></pre></td></tr></table></figure></li>
<li>运行<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -u test:test -<span class="keyword">it</span> <span class="comment">--name openjdk openjdk11_alpine</span></span><br></pre></td></tr></table></figure></li>
<li>查看java<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-42.png" alt="java -version "></p>
<h1 id="查看docker容器信息"><a href="#查看docker容器信息" class="headerlink" title="查看docker容器信息"></a>查看docker容器信息</h1><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器<span class="built_in">id</span>/容器名字</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/21/Docker%E7%9F%A5/pasted-39.png" alt="docker inspect info"></p>
<h1 id="docker-cache信息"><a href="#docker-cache信息" class="headerlink" title="docker cache信息"></a>docker cache信息</h1><ul>
<li>查看<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system <span class="built_in">df</span></span><br></pre></td></tr></table></figure></li>
<li>删除</li>
</ul>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>Docker知识</p><p><span>文章作者：</span>peter.tan</p><p><span>发布时间：</span>2022-08-21</p><p><span>最后更新：</span>2022-09-20</p><p><span>原始链接：</span><a href="/2022/08/21/Docker知识/">https://petertanblog.github.io/2022/08/21/Docker%E7%9F%A5%E8%AF%86/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://petertanblog.github.io/2022/08/21/Docker%E7%9F%A5%E8%AF%86/"></i></span></p><p><span>版权声明：</span>Copyright © 2022 Peter.tan</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://petertanblog.github.io/2022/08/21/Docker%E7%9F%A5%E8%AF%86/" data-id="cl7m10mf9000ct55kfxbecfdn" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtElEQVR42u3aQW7cQAwEQP//08klBwOB5G5yJtgApZOh1WqnZGBIkfz6io9f3473T79f83Tm/Vt/X/l05tiBh4eHt1h6stCn5eZLyZH5tx7vgIeHh3eNl9zufbtPAsOGOnyseHh4eB/Ayx9BkuvOEno8PDy8/4v3vnFvAkaS1uPh4eF9Di+/9aZAcGrpV2oteHh4eDEvT2o/5+8r/T08PDy8dVe9LaqePTbr/HMHPDw8vAu8tuSaN7T2owZtI+3xSjw8PLwLvHxxsyZWC25DTpF84+Hh4R3l5Ultu5S22ZafKYoUeHh4eId4bSLbtrja5Lh9NHUZAg8PD2/Nq1/mg+S1Lf7m7GN9PDw8PLw1b7bENjzMBhH2gQoPDw/vBu9UOjsrdrQl2mFBGQ8PD+8Qrx0F2D+Us4MCP5Q/8PDw8C7w8pmCvOXfFlvz9v+weYaHh4d3gTcrCmwS8Xa7z38RDw8P7zavZbQbdJI0z0oPUfKNh4eHd43XNvhnTaw2WW8T/cfOHh4eHt5RXpK8bppeq2191M374X+Ih4eHd4iXjwjMzuQFhWSj3xQp8PDw8G7z8gWdKnC0pLpAjIeHh3eUl7f827Q7WXR+Jm+V4eHh4d3jbUag9ovbjCBE98fDw8O7xsvDwGykIA8YSbJeBCE8PDy8f8ibta/yFHwWQobvCnh4eHjXeO2GPgsebdOrTawfAwMeHh7eUV7+hXbTrxe0GMCKyrh4eHh4C96prX+fTG9GtR5XhYeHh3eBt3/tz7f42QDBrDmHh4eHd5uXB4M8T5890Vkqv0qs8fDw8Ba8tobRfppv67M22OMZPDw8vA/gvf/85qHkLbGiGIGHh4f3Mbx8SKsNG+34Qh038PDw8A7xzo5SzZpS+fV1YMDDw8M7ymtf+PPyQd4My4PHioGHh4e35f0GZA1UuYVLwbcAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Docker"><i class="fa fa-tag">Docker</i></a></div><div class="post-nav"><a class="pre" href="/2022/08/22/K8S%E7%9F%A5%E8%AF%86/">Kubernetes知识</a><a class="next" href="/2022/08/21/Mac%E6%8A%80%E5%B7%A7/">Mac技巧</a></div><script src="https://utteranc.es/client.js" repo="peterTanBlog/blog_comments" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/images/head.jpg"/></a><p>我喜欢计算编程,专注后端开发 性能调优 spring 框架 spring boot docker k8s</p><a class="info-icon" href="mailto:beityw@hotmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/peterTanBlog/" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Centos/">Centos</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Junittest/">Junittest</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Hexo-admin/" style="font-size: 15px;">Hexo admin</a> <a href="/tags/hexo-%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2/" style="font-size: 15px;">hexo 站内搜索</a> <a href="/tags/hexo-%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo 百度统计</a> <a href="/tags/hexo-google%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo google统计</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E6%94%B6%E5%BD%95hexo%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">百度收录hexo博客</a> <a href="/tags/google%E6%94%B6%E5%BD%95hexo-%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">google收录hexo 博客</a> <a href="/tags/maupassant-%E4%B8%BB%E9%A2%98/" style="font-size: 15px;">maupassant 主题</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/utterances-%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">utterances 评论插件</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/mysql%E9%87%8D%E7%BD%AEroot%E5%AF%86%E7%A0%81/" style="font-size: 15px;">mysql重置root密码</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9Root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改Root密码</a> <a href="/tags/Mysql-%E5%BC%80%E5%90%AF%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/" style="font-size: 15px;">Mysql 开启用户远程访问</a> <a href="/tags/Mysql-%E7%BB%BF%E8%89%B2%E7%89%88%E5%AE%89%E8%A3%85/" style="font-size: 15px;">Mysql 绿色版安装</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改root密码</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">微服务</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring cloud</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/Junit5/" style="font-size: 15px;">Junit5</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/Junit4/" style="font-size: 15px;">Junit4</a> <a href="/tags/Spring-junittest/" style="font-size: 15px;">Spring junittest</a> <a href="/tags/Springboot-junittest/" style="font-size: 15px;">Springboot junittest</a> <a href="/tags/git/" style="font-size: 15px;">git</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/10/09/git/">git</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/10/08/Markdown-%E8%AF%AD%E6%B3%95/">Markdown 语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/10/07/maven/">maven</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/30/Spring/">Spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/30/Java/">Java</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/09/Mysql/">Mysql</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/09/Linux/">Centos Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/09/Junittest/">Junittest</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/08/windows-%E6%8A%80%E5%B7%A7/">windows 技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/05/JVM/">JVM</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://smallwenzi.github.io" title="我的博客" target="_blank">我的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">perter blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>