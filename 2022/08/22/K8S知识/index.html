<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="perter的技术分享"><meta name="keywords" content="k8s pv和pvs,ingress暴露服务,pod和service联系,k8s yaml文件,helm,kubectl命令介绍,k8s介绍,k8s 安装,什么是Kubernetes"><title>Kubernetes知识 | perter blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-MDFK5LR2L9" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MDFK5LR2L9');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '51cd3d8b2f315ceeb62cbeda68c1d672';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Kubernetes知识</h1><a id="logo" href="/.">perter blog</a><p class="description">perter的技术分享</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Kubernetes知识</h1><div class="post-meta">2022-08-22<span> | </span><span class="category"><a href="/categories/Kubernetes/">Kubernetes</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 9.2k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 38</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFKubernetes"><span class="toc-number">1.</span> <span class="toc-text">什么是Kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E4%B8%8Edocker%E8%81%94%E7%B3%BB"><span class="toc-number">1.1.</span> <span class="toc-text">Kubernetes与docker联系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">Kubernetes 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E4%B8%8D%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">Kubernetes不是什么？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes%E7%BB%84%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">Kubernetes组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E7%BB%84%E4%BB%B6%E2%80%93Master-%E7%BB%84%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">Kubernetes组件–Master 组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E7%BB%84%E4%BB%B6%E2%80%93Node-%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">Kubernetes组件–Node 组件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">Kubernetes 核心对象概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-%E5%AE%89%E8%A3%85"><span class="toc-number">5.</span> <span class="toc-text">Kubernetes 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85centos"><span class="toc-number">5.1.</span> <span class="toc-text">虚拟机安装centos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s-master-%E5%AE%89%E8%A3%85k8s-2-15%E7%89%88%E6%9C%AC"><span class="toc-number">5.2.</span> <span class="toc-text">k8s master 安装k8s 2.15版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s-node-%E5%AE%89%E8%A3%85k8s-2-15%E7%89%88%E6%9C%AC"><span class="toc-number">5.3.</span> <span class="toc-text">k8s node 安装k8s 2.15版本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8kubectl-%E8%AE%BF%E9%97%AEKubernetes%E9%9B%86%E7%BE%A4"><span class="toc-number">6.</span> <span class="toc-text">使用kubectl 访问Kubernetes集群</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubectl-deploy-nginx"><span class="toc-number">6.1.</span> <span class="toc-text">kubectl deploy nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubectl-%E7%AE%A1%E7%90%86Kubernetes-%E5%91%BD%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">kubectl 管理Kubernetes 命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Kuboard"><span class="toc-number">7.</span> <span class="toc-text">安装Kuboard</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#YAML%E6%96%87%E4%BB%B6%E9%83%A8%E7%BD%B2-%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0-%E3%80%81%E5%9B%9E%E6%BB%9A%EF%BC%8C%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9"><span class="toc-number">8.</span> <span class="toc-text">YAML文件部署(滚动更新 、回滚，弹性伸缩)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yaml%E8%AF%A6%E8%A7%A3"><span class="toc-number">9.</span> <span class="toc-text">yaml详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#deployment-yaml-%E8%AF%A6%E8%A7%A3"><span class="toc-number">9.1.</span> <span class="toc-text">deployment.yaml 详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service-yaml%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">9.2.</span> <span class="toc-text">Service yaml文件详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pv-yaml"><span class="toc-number">9.3.</span> <span class="toc-text">pv.yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pvc-yaml"><span class="toc-number">9.4.</span> <span class="toc-text">pvc.yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#namespace-yaml"><span class="toc-number">9.5.</span> <span class="toc-text">namespace.yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ingress-yaml"><span class="toc-number">9.6.</span> <span class="toc-text">ingress.yaml</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pod-%E5%92%8C-Sevice%E8%81%94%E7%B3%BB"><span class="toc-number">10.</span> <span class="toc-text">Pod 和 Sevice联系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-Service"><span class="toc-number">10.1.</span> <span class="toc-text">Kubernetes Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service%E7%BD%91%E7%BB%9C%E2%80%93NodePort"><span class="toc-number">10.2.</span> <span class="toc-text">service网络–NodePort</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Loadbalance%E5%B0%86%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E5%87%BA%E6%9D%A5"><span class="toc-number">10.3.</span> <span class="toc-text">通过Loadbalance将服务暴露出来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Ingress%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="toc-number">10.4.</span> <span class="toc-text">通过Ingress暴露服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3Ingress%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">10.4.1.</span> <span class="toc-text">了解Ingress的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ingress-%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="toc-number">10.4.2.</span> <span class="toc-text">Ingress 可以解决什么问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Ingress"><span class="toc-number">10.4.3.</span> <span class="toc-text">安装Ingress</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s-dns"><span class="toc-number">11.</span> <span class="toc-text">k8s-dns</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PV%E5%92%8CPVC"><span class="toc-number">12.</span> <span class="toc-text">PV和PVC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-Provisioning-%E2%80%94%E2%80%94-gt-Binding-%E2%80%94%E2%80%94%E2%80%93-gt-Using%E2%80%94%E2%80%94-gt-Releasing%E2%80%94%E2%80%94-gt-Recycling"><span class="toc-number">12.1.</span> <span class="toc-text">(生命周期)Provisioning ——-&gt; Binding ——–&gt;Using——&gt;Releasing——&gt;Recycling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PV%E5%92%8CPVC%E2%80%93%E4%BB%A5NFS%E4%B8%BA%E4%BE%8B%E5%AD%90"><span class="toc-number">12.2.</span> <span class="toc-text">PV和PVC–以NFS为例子</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#helm"><span class="toc-number">13.</span> <span class="toc-text">helm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Helm-%E7%AE%A1%E7%90%86-k8s%E9%9B%86%E7%BE%A4"><span class="toc-number">13.1.</span> <span class="toc-text">Helm 管理 k8s集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mac%E5%AE%89%E8%A3%85"><span class="toc-number">13.2.</span> <span class="toc-text">mac安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#helm-chart-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">13.3.</span> <span class="toc-text">helm chart 的基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#helm-%E9%83%A8%E7%BD%B2"><span class="toc-number">13.4.</span> <span class="toc-text">helm 部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#helm%EF%BC%88%E5%8D%87%E7%BA%A7-%E5%92%8C%E5%9B%9E%E9%80%80%EF%BC%89"><span class="toc-number">13.5.</span> <span class="toc-text">helm（升级 和回退）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#helm-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">13.6.</span> <span class="toc-text">helm 常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="toc-number">13.7.</span> <span class="toc-text">推荐阅读</span></a></li></ol></li></ol></div></div><div class="post-content"><h1 id="什么是Kubernetes"><a href="#什么是Kubernetes" class="headerlink" title="什么是Kubernetes"></a>什么是Kubernetes</h1><ul>
<li><p>Kubernetes是Google 2014年创建管理的，是Google 10多年大规模容器管理技术Borg的开源版本。</p>
</li>
<li><p>Kubernetes（K8S）是Google开源的容器集群管理系统，其设计源于Google在容器编排方面积累的丰富经验，并结合社区创新的最佳实践。</p>
</li>
<li><p>K8S在Docker容器技术的基础之上，大大地提高了容器化部署应用简单高效。并且具备了完整的集群管理能力，例如服务发现、资源配额、缩容扩容、动态更新、持久化存储、监控、日志等，涵盖项目周期的各个环节。</p>
</li>
<li><p>经过这几年的快速发展，K8S已经成为建设容器云平台的首选方案</p>
</li>
<li><p>Kubernetes的名字来自希腊语，意思是“舵手” 或 “领航员”。K8s是将8个字母“ubernete”替换为“8”的缩写。</p>
</li>
</ul>
<h2 id="Kubernetes与docker联系"><a href="#Kubernetes与docker联系" class="headerlink" title="Kubernetes与docker联系"></a>Kubernetes与docker联系</h2><ul>
<li>Docker是一个容器引擎，用于运行容器，Kubernetes是一个容器编排系统，不具备容器引擎功能，相比Docker是一个更高级封装，而他们在一起堪称珠联璧合，一起搞大事！如图：</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-0.png" alt="Kubernetes与docker联系"></p>
<h1 id="Kubernetes-介绍"><a href="#Kubernetes-介绍" class="headerlink" title="Kubernetes 介绍"></a>Kubernetes 介绍</h1><ul>
<li><p>存储编排<br>Kubernetes 允许您自动挂载您选择的存储系统，例如本地存储、公共云提供商、NFS等。</p>
</li>
<li><p>应用程序健康检查<br>容器内服务可能进场阻塞无法处理请求，可以设置监控检查策略保证 应用健壮性</p>
</li>
<li><p>复制应用程序实例<br>控制器维护着pod的副本数量，保证一个Pod或一组同类的Pod数量始终可用</p>
</li>
<li><p>弹性伸缩<br>根据设定的指标（CPU利用率）自动缩放Pod副本数量</p>
</li>
<li><p>服务发现<br>使用环境变量或DNS服务插件保证容器中程序发现Pod入口访问地址</p>
</li>
<li><p>负载均衡<br>一组Pod副本分配一个私有的集群IP地址，负载均衡转发请求到后端容器。在集群里内部其他Pod可通过这个ClusterIp访问应用</p>
</li>
<li><p>滚动更新<br>更新服务不中断，一次更新一个pod</p>
</li>
<li><p>服务编排<br>通过文件描述部署服务，使得应用程序部署变得更高效</p>
</li>
<li><p>资源监控<br>Node节点组件集成cAdvisor资源收集工具，可通过Heapster汇总整个集群节点资源数据，然后存储到InFluxDB时序数据库，再由Grafana展示</p>
</li>
<li><p>提供认证和授权<br>支持角色访问权限（RBAC）</p>
</li>
<li><p>日志访问<br>可以查询容器运行日志</p>
</li>
</ul>
<h2 id="Kubernetes不是什么？"><a href="#Kubernetes不是什么？" class="headerlink" title="Kubernetes不是什么？"></a>Kubernetes不是什么？</h2><ul>
<li><p>Kubernetes并不是传统的PaaS（平台即服务）系统。</p>
</li>
<li><p>Kubernetes不限制支持应用的类型，不限制应用框架。不限制受支持的语言runtimes (例如, Java, Python, Ruby)，满足12-factor applications 。不区分 “apps” 或者“services”。 Kubernetes支持不同负载应用，包括有状态、无状态、数据处理类型的应用。只要这个应用可以在容器里运行，那么就能很好的运行在Kubernetes上。</p>
</li>
<li><p>Kubernetes不提供中间件（如message buses）、数据处理框架（如Spark）、数据库(如Mysql)或者集群存储系统(如Ceph)作为内置服务。但这些应用都可以运行在Kubernetes上面。</p>
</li>
<li><p>Kubernetes不部署源码不编译应用。持续集成的 (CI)工作流方面，不同的用户有不同的需求和偏好的区域，因此，我们提供分层的 CI工作流，但并不定义它应该如何工作。</p>
</li>
<li><p>Kubernetes允许用户选择自己的日志、监控和报警系统。</p>
</li>
<li><p>Kubernetes不提供或授权一个全面的应用程序配置 语言&#x2F;系统（例如，jsonnet）。</p>
</li>
<li><p>Kubernetes不提供任何机器配置、维护、管理或者自修复系统。</p>
</li>
</ul>
<h1 id="Kubernetes组件"><a href="#Kubernetes组件" class="headerlink" title="Kubernetes组件"></a>Kubernetes组件</h1><p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-1.png" alt="Kubernetes组件"></p>
<h2 id="Kubernetes组件–Master-组件"><a href="#Kubernetes组件–Master-组件" class="headerlink" title="Kubernetes组件–Master 组件"></a>Kubernetes组件–Master 组件</h2><ul>
<li>Master 组件提供集群的控制平面<br>Master 组件对集群进行全局决策（例如，调度），并检测和响应集群事件（例如，当不满足部署的 replicas 字段时，启动新的 pod）。</li>
<li>kube-apiserver<br>主节点上负责提供 Kubernetes API 服务的组件；它是 Kubernetes 控制面的前端。</li>
<li>etcd<br>etcd 是兼具一致性和高可用性的键值数据库，可以作为保存 Kubernetes 所有集群数据的后台数据库。</li>
<li>kube-scheduler<br>主节点上的组件，该组件监视那些新创建的未指定运行节点的 Pod，并选择节点让 Pod 在上面运行。<br>调度决策考虑的因素包括单个 Pod 和 Pod 集合的资源需求、硬件&#x2F;软件&#x2F;策略约束、亲和性和反亲和性规范、数据位置、工作负载间的干扰和最后时限。</li>
<li>kube-controller-manager<br>在主节点上运行控制器的组件。<br>从逻辑上讲，每个控制器都是一个单独的进程，但是为了降低复杂性，它们都被编译到同一个可执行文件，并在一个进程中运行。<br>这些控制器包括:<ul>
<li>节点控制器（Node Controller）: 负责在节点出现故障时进行通知和响应。</li>
<li>副本控制器（Replication Controller）: 负责为系统中的每个副本控制器对象维护正确数量的 Pod。</li>
<li>端点控制器（Endpoints Controller）: 填充端点(Endpoints)对象(即加入 Service 与 Pod)。</li>
<li>服务帐户和令牌控制器（Service Account &amp; Token Controllers）: 为新的命名空间创建默认帐户和 API 访问令牌</li>
</ul>
</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-2.png" alt="kube-controller-manager"></p>
<ul>
<li>容器运行环境(Container Runtime)<br>容器运行环境是负责运行容器的软件。–docker</li>
</ul>
<h2 id="Kubernetes组件–Node-组件"><a href="#Kubernetes组件–Node-组件" class="headerlink" title="Kubernetes组件–Node 组件"></a>Kubernetes组件–Node 组件</h2><ul>
<li><p>kubelet<br>一个在集群中每个节点上运行的代理。它保证容器都运行在 Pod 中。<br>kubelet 接收一组通过各类机制提供给它的 PodSpecs，确保这些 PodSpecs 中描述的容器处于运行状态且健康。kubelet 不会管理不是由 Kubernetes 创建的容器。</p>
</li>
<li><p>kube-proxy<br>kube-proxy 是集群中每个节点上运行的网络代理,实现 Kubernetes Service 概念的一部分。<br>kube-proxy 维护节点上的网络规则。这些网络规则允许从集群内部或外部的网络会话与 Pod 进行网络通信。<br>如果有 kube-proxy 可用，它将使用操作系统数据包过滤层。否则，kube-proxy 会转发流量本身。</p>
</li>
<li><p>容器运行环境(Container Runtime)<br>容器运行环境是负责运行容器的软件。–docker</p>
</li>
</ul>
<h1 id="Kubernetes-核心对象概念"><a href="#Kubernetes-核心对象概念" class="headerlink" title="Kubernetes 核心对象概念"></a>Kubernetes 核心对象概念</h1><ul>
<li><p>pod<br>Pod是最小部署 单元，一个Pod有一个或多个容器组成，Pod中容器共享存储和网站，在同一个DOcker主机上运行</p>
</li>
<li><p>Service<br>Service一个应用服务抽象，定义了Pod逻辑集合和访问这个Pod集成的策略<br>Service代理Pod集合对外表现是为一个访问入口，分配一个集群Ip地址，来自这个Ip的请求将负载均衡转发后端Pod中容器<br>Servie 通过Label Selector 选择一组Pod提供服务</p>
</li>
<li><p>Volume<br> 数据卷，供于Pod使用的数据</p>
</li>
<li><p>Namespace<br> 命名空间将对象逻辑上分配到不同Namespace,可以不同项目、用户等区分管理，从而实现多租户。命名空间也成为虚拟集群</p>
</li>
<li><p>Label<br> 标签用于区分对象（比如Pod service）,键&#x2F;值对存在，每个对象可以有多个标签，通过标签关联对象</p>
</li>
<li><p>ReplicaSet<br>下一代Replication Controller，确保任何给定时间指定Pod副本数量，并提供声明式更新等功能<br>RC与RS唯一区别就是Label Selector支持不同，RS支持新的基于集合的标签，RC仅支持基于等式标签</p>
</li>
<li><p>Deployment<br>是更高层次的PAI对象，它管理Replica和Pod，并提供声明式更新等功能<br>官方建议使用Deployment管理ReplicaSet ,而不是直接使用RelicaSet，这就意味着可能永远不需要直接操作ReplicaSet对象</p>
</li>
<li><p>Job<br>一次性任务，运行完成后Pod销毁。不再重新启动部署新容器，还可以任务定时运行</p>
</li>
<li><p>StatefulSet<br>适合持久性的应用程序，有唯一的网络标识符（IP）,持久存储，有序的部署、扩展、删除和滚动更新</p>
</li>
<li><p>DaementSet<br>DaementSet确保所有（或一些）节点运行同一个Pod,当节点加入kubernets集群中，Pod会调到该节点上运行。当节点集群中移除，DaementSet的Pod会被删除，删除DaemonSet会清理它所有创建的Pod</p>
</li>
</ul>
<h1 id="Kubernetes-安装"><a href="#Kubernetes-安装" class="headerlink" title="Kubernetes 安装"></a>Kubernetes 安装</h1><ul>
<li>minikube<br>Minikube是一个工具，可以在本地快速运行一个单点的Kubernetes，尝试Kubernetes或日常开发的用户使用。不能用于生产环境。<br>官方地址：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/minikube/">https://kubernetes.io/docs/setup/minikube/</a></li>
<li>kubeadm<br>Kubeadm也是一个工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。<br>官方地址：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</a></li>
<li>二进制包<br>从官方下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。</li>
</ul>
<h2 id="虚拟机安装centos"><a href="#虚拟机安装centos" class="headerlink" title="虚拟机安装centos"></a>虚拟机安装centos</h2><ul>
<li>k8s matser: 2核cpu 系统 cenots 7.9 硬盘20g 内存2048m  ip:192.168.31.59 docker版本:18.09.7</li>
<li>k8s node :2核cpu 系统 cenots 7.9 硬盘20g 内存2048m  ip:192.168.31.181 docker版本:18.09.7</li>
</ul>
<h2 id="k8s-master-安装k8s-2-15版本"><a href="#k8s-master-安装k8s-2-15版本" class="headerlink" title="k8s master 安装k8s 2.15版本"></a>k8s master 安装k8s 2.15版本</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Kubernetes 安装部署</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Kubernetes --master</span></span><br><span class="line"><span class="comment"># ipaddr 确认主机ip</span></span><br><span class="line"><span class="comment"># 在 master 节点和 worker 节点都要执行</span></span><br><span class="line">cat <span class="regexp">/etc/</span>redhat-release</span><br><span class="line"><span class="comment"># 此处 hostname 的输出将会是该机器在 Kubernetes 集群中的节点名字</span></span><br><span class="line"><span class="comment"># 不能使用 localhost 作为节点的名字</span></span><br><span class="line">hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 lscpu 命令，核对 CPU 信息</span></span><br><span class="line"><span class="comment"># Architecture: x86_64    本安装文档不支持 arm 架构</span></span><br><span class="line"><span class="comment"># CPU(s):       2         CPU 内核数量不能低于 2</span></span><br><span class="line">lscpu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 以下脚本在master执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 hostname</span></span><br><span class="line">hostnamectl set-hostname k8s-master</span><br><span class="line"><span class="comment"># 查看修改结果</span></span><br><span class="line">hostnamectl status</span><br><span class="line"><span class="comment"># 设置 hostname 解析</span></span><br><span class="line">echo <span class="string">&quot;127.0.0.1   $(hostname)&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line">cat <span class="regexp">/etc/</span>hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##安装docker:</span></span><br><span class="line"><span class="comment">##卸载旧版本</span></span><br><span class="line"> yum remove -y docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-selinux \</span><br><span class="line">docker-engine-selinux \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment">##设置yum docker repository</span></span><br><span class="line"> yum install -y yum-utils  device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line">  yum-config-manager --add-repo https:<span class="regexp">//</span>download.docker.com<span class="regexp">/linux/</span>centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装并启动 docker</span></span><br><span class="line"> yum install -y docker-ce-<span class="number">18.09</span>.<span class="number">7</span> docker-ce-cli-<span class="number">18.09</span>.<span class="number">7</span> containerd.io</span><br><span class="line"> systemctl enable docker</span><br><span class="line"> systemctl start docker</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查看docker版本</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 nfs-utils</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置K8S的yum源</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; <span class="regexp">/etc/yum</span>.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/repos/</span>kubernetes-el7-x86_64</span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line">repo_gpgcheck=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/yum</span>-key.gpg</span><br><span class="line">       http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/</span>rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line"><span class="comment">#关闭 防火墙、SeLinux、swap</span></span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line"></span><br><span class="line">swapoff -a</span><br><span class="line">yes | cp <span class="regexp">/etc/</span>fstab <span class="regexp">/etc/</span>fstab_bak</span><br><span class="line">cat <span class="regexp">/etc/</span>fstab_bak |grep -v swap &gt; <span class="regexp">/etc/</span>fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改 /etc/sysctl.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line"><span class="comment">## 添加以下内容</span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">1</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = <span class="number">1</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="comment"># 令以上内容执行生效</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装kubelet、kubeadm、kubectl</span></span><br><span class="line">yum install -y kubelet-<span class="number">1.15</span>.<span class="number">1</span> kubeadm-<span class="number">1.15</span>.<span class="number">1</span> kubectl-<span class="number">1.15</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改docker Cgroup Driver为systemd</span></span><br><span class="line"> vi <span class="regexp">/usr/</span>lib<span class="regexp">/systemd/</span>system/docker.service</span><br><span class="line"><span class="comment">## 在ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock添加</span></span><br><span class="line"> --exec-opt native.cgroupdriver=systemd</span><br><span class="line"></span><br><span class="line"><span class="comment">##设置 docker 镜像</span></span><br><span class="line">mkdir -p <span class="regexp">/etc/</span>docker</span><br><span class="line">tee <span class="regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hrei34jl.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"> <span class="comment"># 重启 docker，并启动 kubelet</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化 master 节点 需要换成物理网络ip</span></span><br><span class="line"><span class="comment"># 配置 apiserver.demo 的域名</span></span><br><span class="line">echo <span class="string">&quot;192.168.31.59 apiserver.demo&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">##创建 ./kubeadm-config.yaml</span></span><br><span class="line">cat &lt;&lt;EOF &gt; ./kubeadm-config.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta1</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.<span class="number">15.1</span></span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">controlPlaneEndpoint: <span class="string">&quot;apiserver.demo:6443&quot;</span></span><br><span class="line">networking:</span><br><span class="line">  podSubnet: <span class="string">&quot;10.100.0.1/20&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化 apiserver  根据您服务器网速的情况，您需要等候 1 - 10 分钟</span></span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs</span><br><span class="line"></span><br><span class="line">rm -rf <span class="regexp">/root/</span>.kube/</span><br><span class="line">mkdir <span class="regexp">/root/</span>.kube/</span><br><span class="line">cp -i <span class="regexp">/etc/</span>kubernetes<span class="regexp">/admin.conf /</span>root<span class="regexp">/.kube/</span>config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">##安装 calico</span></span><br><span class="line"></span><br><span class="line">kubectl apply -f https:<span class="regexp">//</span>docs.projectcalico.org<span class="regexp">/v3.6/g</span>etting-started<span class="regexp">/kubernetes/i</span>nstallation<span class="regexp">/hosted/</span>kubernetes-datastore<span class="regexp">/calico-networking/</span><span class="number">1.7</span>/calico.yaml</span><br><span class="line"><span class="comment">##等待calico安装就绪：</span></span><br><span class="line"><span class="comment"># 可在 master 节点执行  执行如下命令，等待 3-10 分钟，直到所有的容器组处于 Running 状态</span></span><br><span class="line">watch kubectl get pod -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 master 初始化结果</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
<p>安装成功：</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-4.png" alt="kubectl get pod -n kube-system"></p>
<h2 id="k8s-node-安装k8s-2-15版本"><a href="#k8s-node-安装k8s-2-15版本" class="headerlink" title="k8s node 安装k8s 2.15版本"></a>k8s node 安装k8s 2.15版本</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">##以下脚本在node节点执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 master 节点和 worker 节点都要执行</span></span><br><span class="line">cat <span class="regexp">/etc/</span>redhat-release</span><br><span class="line"><span class="comment"># 此处 hostname 的输出将会是该机器在 Kubernetes 集群中的节点名字</span></span><br><span class="line"><span class="comment"># 不能使用 localhost 作为节点的名字</span></span><br><span class="line">hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 lscpu 命令，核对 CPU 信息</span></span><br><span class="line"><span class="comment"># Architecture: x86_64    本安装文档不支持 arm 架构</span></span><br><span class="line"><span class="comment"># CPU(s):       2         CPU 内核数量不能低于 2</span></span><br><span class="line">lscpu</span><br><span class="line"><span class="comment"># 修改 hostname</span></span><br><span class="line">hostnamectl set-hostname k8s-node </span><br><span class="line"><span class="comment"># 查看修改结果</span></span><br><span class="line">hostnamectl status</span><br><span class="line"><span class="comment"># 设置 hostname 解析</span></span><br><span class="line">echo <span class="string">&quot;127.0.0.1   $(hostname)&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line">cat <span class="regexp">/etc/</span>hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装docker:</span></span><br><span class="line"><span class="comment">##卸载旧版本</span></span><br><span class="line"> yum remove -y docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-selinux \</span><br><span class="line">docker-engine-selinux \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment">##设置yum docker repository</span></span><br><span class="line"> yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line">yum-config-manager --add-repo https:<span class="regexp">//</span>download.docker.com<span class="regexp">/linux/</span>centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装并启动 docker</span></span><br><span class="line"> yum install -y docker-ce-<span class="number">18.09</span>.<span class="number">7</span> docker-ce-cli-<span class="number">18.09</span>.<span class="number">7</span> containerd.io</span><br><span class="line"> systemctl enable docker</span><br><span class="line"> systemctl start docker</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查看docker版本</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 nfs-utils</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"><span class="comment">#配置K8S的yum源</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; <span class="regexp">/etc/yum</span>.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/repos/</span>kubernetes-el7-x86_64</span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line">repo_gpgcheck=<span class="number">0</span></span><br><span class="line">gpgkey=http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/yum</span>-key.gpg</span><br><span class="line">       http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/kubernetes/yum</span><span class="regexp">/doc/</span>rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line"><span class="comment">#关闭 防火墙、SeLinux、swap</span></span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line"></span><br><span class="line">swapoff -a</span><br><span class="line">yes | cp <span class="regexp">/etc/</span>fstab <span class="regexp">/etc/</span>fstab_bak</span><br><span class="line">cat <span class="regexp">/etc/</span>fstab_bak |grep -v swap &gt; <span class="regexp">/etc/</span>fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改 /etc/sysctl.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line"><span class="comment">## 添加以下内容</span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">1</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = <span class="number">1</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="comment"># 令以上内容执行生效</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装kubelet、kubeadm、kubectl</span></span><br><span class="line">yum install -y kubelet-<span class="number">1.15</span>.<span class="number">1</span> kubeadm-<span class="number">1.15</span>.<span class="number">1</span> kubectl-<span class="number">1.15</span>.<span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 修改docker Cgroup Driver为systemd</span></span><br><span class="line"> vi <span class="regexp">/usr/</span>lib<span class="regexp">/systemd/</span>system/docker.service</span><br><span class="line"><span class="comment">## 在ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock添加</span></span><br><span class="line"> --exec-opt native.cgroupdriver=systemd</span><br><span class="line"></span><br><span class="line"><span class="comment">##设置 docker 镜像</span></span><br><span class="line">mkdir -p <span class="regexp">/etc/</span>docker</span><br><span class="line"> tee <span class="regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://hrei34jl.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 重启 docker，并启动 kubelet</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##针对所有的 worker 节点执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只在 worker 节点执行 设置masterip</span></span><br><span class="line">echo <span class="string">&quot;192.168.31.59  apiserver.demo&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line"><span class="comment"># 到k8s master 主机执行获得 join命令参数 待</span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"></span><br><span class="line">获取到命令复制至k8s node执行： kubeadm join apiserver.demo:<span class="number">6443</span> --token <span class="number">1</span>rgjij.n5a0x5mma7v7cylj     --discovery-token-ca-cert-hash sha256:ee62f5d762d73b4dde5abc2dc2ae0dfb69cd0e19ab8587f1b257e60f9aa648d5 </span><br><span class="line"></span><br><span class="line">可以在k8s master执行：</span><br><span class="line">watch kubectl get pod -n kube-system</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
<p>node ready:</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-3.png" alt="kubectl get nodes"></p>
<h1 id="使用kubectl-访问Kubernetes集群"><a href="#使用kubectl-访问Kubernetes集群" class="headerlink" title="使用kubectl 访问Kubernetes集群"></a>使用kubectl 访问Kubernetes集群</h1><p>以下后续kubectl命令在k8s master下执行kubectl</p>
<ul>
<li>kubectl version<br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-5.png" alt="kubectl version"></li>
</ul>
<h2 id="kubectl-deploy-nginx"><a href="#kubectl-deploy-nginx" class="headerlink" title="kubectl deploy nginx"></a>kubectl deploy nginx</h2><ul>
<li>kubectl run nginx(默认namespace:default)<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">run</span> nginx <span class="attribute">--image</span>=nginx <span class="attribute">--replicas</span>=3</span><br></pre></td></tr></table></figure>
<img src="/2022/08/22/K8S%E7%9F%A5/pasted-6.png" alt="kubectl run nginx "></li>
<li>查看pod 列表<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">get</span> pod -o wide -n <span class="keyword">default</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-7.png" alt="图片/2022/08/22/K8S知/pasted-7.png"></p>
<ul>
<li>查看pod详细信息<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">describe</span> pod  nginx<span class="number">-7</span>bb7cd8db5<span class="operator">-</span>kjfm4 <span class="operator">-</span>n <span class="keyword">default</span></span><br></pre></td></tr></table></figure>
<img src="/2022/08/22/K8S%E7%9F%A5/pasted-8.png" alt="kubectl describe pod "></li>
<li>映射端口<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment nginx <span class="attribute">--port</span>=88 <span class="attribute">--target-port</span>=80 <span class="attribute">--type</span>=NodePort -n default</span><br></pre></td></tr></table></figure></li>
<li>查看service<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">get</span> svc -o wide -n <span class="keyword">default</span></span><br></pre></td></tr></table></figure>
<img src="/2022/08/22/K8S%E7%9F%A5/pasted-9.png" alt="查看service"></li>
<li><a target="_blank" rel="noopener" href="http://192.168.31.59:32125/">http://192.168.31.59:32125</a><br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-10.png" alt="访问"></li>
<li>查看pod日志<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">log</span> -f  nginx<span class="number">-7</span>bb7cd8db5-kjfm4 -n <span class="literal">default</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-14.png" alt="图片/2022/08/22/K8S知/pasted-14.png"></p>
<ul>
<li>删除deploy<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">delete</span> deployment nginx -n <span class="keyword">default</span></span><br><span class="line">kubectl <span class="keyword">delete</span> svc nginx -n <span class="keyword">default</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="kubectl-管理Kubernetes-命令"><a href="#kubectl-管理Kubernetes-命令" class="headerlink" title="kubectl 管理Kubernetes 命令"></a>kubectl 管理Kubernetes 命令</h2><p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-11.png" alt="kubectl 管理Kubernetes 命令1"></p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-12.png" alt="kubectl 管理Kubernetes 命令2"></p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-13.png" alt="kubectl 管理Kubernetes 命令3"></p>
<p>##部署一个kuboard<br>kubectl apply -f <a target="_blank" rel="noopener" href="https://kuboard.cn/install-script/kuboard.yaml">https://kuboard.cn/install-script/kuboard.yaml</a></p>
<h1 id="安装Kuboard"><a href="#安装Kuboard" class="headerlink" title="安装Kuboard"></a>安装Kuboard</h1><p>Kuboard 是 Kubernetes 的一款图形化管理界面。</p>
<p><a target="_blank" rel="noopener" href="https://kuboard.cn/learning/">https://kuboard.cn/learning/</a></p>
<ul>
<li><p>安装命令</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https:<span class="regexp">//</span>kuboard.cn<span class="regexp">/install-script/</span>kuboard.yaml</span><br></pre></td></tr></table></figure></li>
<li><p>执行命令 获取登录token</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get secret <span class="constructor">$(<span class="params">kubectl</span> -<span class="params">n</span> <span class="params">kube</span>-<span class="params">system</span> <span class="params">get</span> <span class="params">secret</span> | <span class="params">grep</span> <span class="params">kuboard</span>-<span class="params">user</span> | <span class="params">awk</span> &#x27;&#123;<span class="params">print</span> $1&#125;&#x27;)</span> -o go-template=&#x27;&#123;&#123;.data.token&#125;&#125;&#x27; <span class="pattern-match">| base64 -d</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>访问:<a target="_blank" rel="noopener" href="http://192.168.31.59:32567/dashboard">http://192.168.31.59:32567/dashboard</a><br>(使用master主机ip 访问32567端口)<br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-15.png" alt="kuboard"></p>
</li>
<li><p>使用第二步获取token进行登录</p>
</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-16.png" alt="kuboard界面"></p>
<h1 id="YAML文件部署-滚动更新-、回滚，弹性伸缩"><a href="#YAML文件部署-滚动更新-、回滚，弹性伸缩" class="headerlink" title="YAML文件部署(滚动更新 、回滚，弹性伸缩)"></a>YAML文件部署(滚动更新 、回滚，弹性伸缩)</h1><ul>
<li>nginx .yaml<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.15</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service-nodeport</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure></li>
<li>在k8s master执行 启动nginx:1.15 ，3个实例<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f nginx.yaml --<span class="built_in">record</span></span><br></pre></td></tr></table></figure></li>
<li>新开一个终端：<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch kubectl <span class="built_in">get</span> pod -o wide  </span><br></pre></td></tr></table></figure></li>
<li>弹性伸缩<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale <span class="attribute">--replicas</span>=5 deployments/nginx</span><br><span class="line">kubectl scale <span class="attribute">--replicas</span>=10 deployments/nginx</span><br><span class="line">kubectl scale <span class="attribute">--replicas</span>=2 deployments/nginx</span><br></pre></td></tr></table></figure></li>
<li>滚动更新<br>nginx16  镜像nginx:1.16<br>nginx17 镜像nginx:1.17<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f nginx16.yaml --<span class="built_in">record</span></span><br><span class="line">kubectl <span class="built_in">apply</span> -f nginx17.yaml --<span class="built_in">record</span></span><br></pre></td></tr></table></figure></li>
<li>列出版本<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout <span class="built_in">history</span> deployment nginx</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-17.png" alt="列出版本"></p>
<ul>
<li>回滚版本<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment nginx <span class="attribute">--to-revision</span>=2</span><br></pre></td></tr></table></figure></li>
<li>删除nginx<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">delete</span> -f nginx16.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="yaml详解"><a href="#yaml详解" class="headerlink" title="yaml详解"></a>yaml详解</h1><h2 id="deployment-yaml-详解"><a href="#deployment-yaml-详解" class="headerlink" title="deployment.yaml 详解"></a>deployment.yaml 详解</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span>   <span class="comment">#接口版本</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                 <span class="comment">#接口类型</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cango-demo</span>               <span class="comment">#Deployment名称</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">cango-prd</span>           <span class="comment">#命名空间</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">cango-demo</span>              <span class="comment">#标签</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span>  <span class="comment">##由于replicas为3,则整个升级,pod个数在2-4个之间</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">1</span>      <span class="comment">#滚动升级时会先启动1个pod</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span> <span class="comment">#滚动升级时允许的最大Unavailable的pod个数</span></span><br><span class="line">  <span class="attr">template:</span>         </span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">cango-demo</span>  <span class="comment">#模板名称必填</span></span><br><span class="line">    <span class="attr">sepc:</span> <span class="comment">#定义容器模板，该模板可以包含多个容器</span></span><br><span class="line">      <span class="attr">containers:</span>                                                                   </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cango-demo</span>                                                           <span class="comment">#镜像名称</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">swr.cn-east-2.myhuaweicloud.com/cango-prd/cango-demo:0.0.1-SNAPSHOT</span> <span class="comment">#镜像地址</span></span><br><span class="line">          <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /etc/config/path/to/special-key&quot;</span> ]    <span class="comment">#启动命令</span></span><br><span class="line">          <span class="attr">args:</span>                                                                <span class="comment">#启动参数</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-storage.local.retention=$(STORAGE_RETENTION)&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-storage.local.memory-chunks=$(STORAGE_MEMORY_CHUNKS)&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-config.file=/etc/prometheus/prometheus.yml&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-alertmanager.url=http://alertmanager:9093/alertmanager&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-web.external-url=$(EXTERNAL_URL)&#x27;</span></span><br><span class="line">    <span class="comment">#如果command和args均没有写，那么用Docker默认的配置。</span></span><br><span class="line">    <span class="comment">#如果command写了，但args没有写，那么Docker默认的配置会被忽略而且仅仅执行.yaml文件的command（不带任何参数的）。</span></span><br><span class="line">    <span class="comment">#如果command没写，但args写了，那么Docker默认配置的ENTRYPOINT的命令行会被执行，但是调用的参数是.yaml中的args。</span></span><br><span class="line">    <span class="comment">#如果如果command和args都写了，那么Docker默认的配置被忽略，使用.yaml的配置。</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>  <span class="comment">#如果不存在则拉取</span></span><br><span class="line">          <span class="attr">livenessProbe:</span>       <span class="comment">#表示container是否处于live状态。如果LivenessProbe失败，LivenessProbe将会通知kubelet对应的container不健康了。随后kubelet将kill掉container，并根据RestarPolicy进行进一步的操作。默认情况下LivenessProbe在第一次检测之前初始化值为Success，如果container没有提供LivenessProbe，则也认为是Success；</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/health</span> <span class="comment">#如果没有心跳检测接口就为/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">60</span> <span class="comment">##启动后延时多久开始运行检测</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/health</span> <span class="comment">#如果没有心跳检测接口就为/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span> <span class="comment">##启动后延时多久开始运行检测</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">resources:</span>              <span class="comment">##CPU内存限制</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2048Mi</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2048Mi</span></span><br><span class="line">          <span class="attr">env:</span>                    <span class="comment">##通过环境变量的方式，直接传递pod=自定义Linux OS环境变量</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LOCAL_KEY</span>     <span class="comment">#本地Key</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">value</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIG_MAP_KEY</span>  <span class="comment">#局策略可使用configMap的配置Key，</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">special-config</span>   <span class="comment">#configmap中找到name为special-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">special.type</span>      <span class="comment">#找到name为special-config里data下的key</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">8080</span> <span class="comment">#对service暴露端口</span></span><br><span class="line">          <span class="attr">volumeMounts:</span>     <span class="comment">#挂载volumes中定义的磁盘</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">log-cache</span></span><br><span class="line">            <span class="attr">mount:</span> <span class="string">/tmp/log</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sdb</span>       <span class="comment">#普通用法，该卷跟随容器销毁，挂载一个目录</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/data/media</span>    </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span>    <span class="comment">#直接挂载硬盘方法，如挂载下面的nfs目录到/mnt/nfs</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/mnt/nfs</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment">#高级用法第1种，将ConfigMap的log-script,backup-script分别挂载到/etc/config目录下的一个相对路径path/to/...下，如果存在同名文件，直接覆盖。</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/etc/config</span>       </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rbd-pvc</span>                <span class="comment">#高级用法第2中，挂载PVC(PresistentVolumeClaim)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#使用volume将ConfigMap作为文件或目录直接挂载，其中每一个key-value键值对都会生成一个文件，key为文件名，value为内容，</span></span><br><span class="line">  <span class="attr">volumes:</span>  <span class="comment"># 定义磁盘给上面volumeMounts挂载</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">log-cache</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sdb</span>  <span class="comment">#挂载宿主机上面的目录</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/any/path/it/will/be/replaced</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment"># 供ConfigMap文件内容到指定路径使用</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment">#ConfigMap中名称</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">log-script</span>           <span class="comment">#ConfigMap中的Key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">path/to/log-script</span>  <span class="comment">#指定目录下的一个相对路径path/to/log-script</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">backup-script</span>        <span class="comment">#ConfigMap中的Key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">path/to/backup-script</span>  <span class="comment">#指定目录下的一个相对路径path/to/backup-script</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span>         <span class="comment">#供挂载NFS存储类型</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">10.42</span><span class="number">.0</span><span class="number">.55</span>          <span class="comment">#NFS服务器地址</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/opt/public</span>           <span class="comment">#showmount -e 看一下路径</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rbd-pvc</span>                 <span class="comment">#挂载PVC磁盘</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">rbd-pvc1</span>         <span class="comment">#挂载已经申请的pvc磁盘</span></span><br></pre></td></tr></table></figure>
<h2 id="Service-yaml文件详解"><a href="#Service-yaml文件详解" class="headerlink" title="Service yaml文件详解"></a>Service yaml文件详解</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">matadata:</span>                                <span class="comment">#元数据</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">string</span>                           <span class="comment">#service的名称</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">string</span>                      <span class="comment">#命名空间  </span></span><br><span class="line">  <span class="attr">labels:</span>                                <span class="comment">#自定义标签属性列表</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">annotations:</span>                           <span class="comment">#自定义注解属性列表  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line"><span class="attr">spec:</span>                                    <span class="comment">#详细描述</span></span><br><span class="line">  <span class="attr">selector:</span> []                           <span class="comment">#label selector配置，将选择具有label标签的Pod作为管理 </span></span><br><span class="line">                                         <span class="comment">#范围</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span>                           <span class="comment">#service的类型，指定service的访问方式，默认为 </span></span><br><span class="line">                                         <span class="comment">#clusterIp</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">string</span>                      <span class="comment">#虚拟服务地址      </span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">string</span>                <span class="comment">#是否支持session</span></span><br><span class="line">  <span class="attr">ports:</span>                                 <span class="comment">#service需要暴露的端口列表</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>                         <span class="comment">#端口名称</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">string</span>                     <span class="comment">#端口协议，支持TCP和UDP，默认TCP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">int</span>                            <span class="comment">#服务监听的端口号</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">int</span>                      <span class="comment">#需要转发到后端Pod的端口号</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="string">int</span>                        <span class="comment">#当type = NodePort时，指定映射到物理机的端口号</span></span><br><span class="line">  <span class="attr">status:</span>                                <span class="comment">#当spce.type=LoadBalancer时，设置外部负载均衡器的地址</span></span><br><span class="line">    <span class="attr">loadBalancer:</span>                        <span class="comment">#外部负载均衡器    </span></span><br><span class="line">      <span class="attr">ingress:</span>                           <span class="comment">#外部负载均衡器 </span></span><br><span class="line">        <span class="attr">ip:</span> <span class="string">string</span>                       <span class="comment">#外部负载均衡器的Ip地址值</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">string</span>                 <span class="comment">#外部负载均衡器的主机名</span></span><br></pre></td></tr></table></figure>
<h2 id="pv-yaml"><a href="#pv-yaml" class="headerlink" title="pv.yaml"></a>pv.yaml</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="pvc-yaml"><a href="#pvc-yaml" class="headerlink" title="pvc.yaml"></a>pvc.yaml</h2><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">nginx-pvc</span></span><br><span class="line">  <span class="attribute">namespace</span><span class="punctuation">:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">accessModes</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attribute">resources</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">requests</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">storage</span><span class="punctuation">:</span> <span class="string">20Gi</span></span><br><span class="line">  <span class="attribute">storageClassName</span><span class="punctuation">:</span> <span class="string">nginx-pv</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="namespace-yaml"><a href="#namespace-yaml" class="headerlink" title="namespace.yaml"></a>namespace.yaml</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">kind:</span> Namespace  --创建命名空间</span><br><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> nginx  --名称</span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line"><span class="symbol">   name:</span> nginx</span><br></pre></td></tr></table></figure>
<h2 id="ingress-yaml"><a href="#ingress-yaml" class="headerlink" title="ingress.yaml"></a>ingress.yaml</h2><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">ingress-yaohong1</span></span><br><span class="line">  <span class="attribute">namespace</span><span class="punctuation">:</span> <span class="string">kuboard</span></span><br><span class="line">  <span class="attribute">annotations</span><span class="punctuation">:</span></span><br><span class="line">       <span class="attribute">kubernetes.io/ingress.class</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">rules</span><span class="punctuation">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">host: test.nginx1.com</span></span><br><span class="line">      <span class="attribute">http</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">paths</span><span class="punctuation">:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">path: /                </span></span><br><span class="line">          <span class="attribute">backend</span><span class="punctuation">: </span></span><br><span class="line">            <span class="attribute">serviceName</span><span class="punctuation">:</span> <span class="string">nginx-service</span></span><br><span class="line">            <span class="attribute">servicePort</span><span class="punctuation">:</span> <span class="string">80</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">host: test.kuboard.com</span></span><br><span class="line">      <span class="attribute">http</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">paths</span><span class="punctuation">:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">path: /               </span></span><br><span class="line">          <span class="attribute">backend</span><span class="punctuation">: </span></span><br><span class="line">            <span class="attribute">serviceName</span><span class="punctuation">:</span> <span class="string">kuboard</span></span><br><span class="line">            <span class="attribute">servicePort</span><span class="punctuation">:</span> <span class="string">80</span></span><br></pre></td></tr></table></figure>

<h1 id="Pod-和-Sevice联系"><a href="#Pod-和-Sevice联系" class="headerlink" title="Pod 和 Sevice联系"></a>Pod 和 Sevice联系</h1><ul>
<li>Kubernetes 中 Pod 是随时可以消亡的（节点故障、容器内应用程序错误等原因）。如果使用 Deployment 运行您的应用程序，Deployment 将会在 Pod 消亡后再创建一个新的 Pod 以维持所需要的副本数。每一个 Pod 有自己的 IP 地址，然而，对于 Deployment 而言，对应 Pod 集合是动态变化的。<br>这个现象导致了如下问题：<ul>
<li>如果某些 Pod（假设是 ‘backends’）为另外一些 Pod（假设是 ‘frontends’）提供接口，在 ‘backends’ 中的 Pod 集合不断变化（IP 地址也跟着变化）的情况下，</li>
<li>‘frontends’ 中的 Pod 如何才能知道应该将请求发送到哪个 IP 地址？</li>
</ul>
</li>
</ul>
<p>Service 存在的意义，就是为了解决这个问题。</p>
<h2 id="Kubernetes-Service"><a href="#Kubernetes-Service" class="headerlink" title="Kubernetes Service"></a>Kubernetes Service</h2><p>Kubernetes 中 Service 是一个 API 对象，通过 kubectl + YAML 或者 Kuboard，定义一个 Service，可以将符合 Service 指定条件的 Pod 作为可通过网络访问的服务提供给服务调用者。<br>Service 是 Kubernetes 中的一种服务发现机制：<br>    * Pod 有自己的 IP 地址<br>    * Service 被赋予一个唯一的 dns name<br>    * Service 通过 label selector 选定一组 Pod<br>    * Service 实现负载均衡，可将请求均衡分发到选定这一组 Pod 中</p>
<p>例如，假设有一个无状态的图像处理后端程序运行了 3 个 Pod 副本。这些副本是相互可替代的（前端程序调用其中任何一个都可以）。在后端程序的副本集中的 Pod 经常变化（销毁、重建、扩容、缩容等）的情况下，前端程序不应该关注这些变化。</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-18.png" alt="服务图"></p>
<h2 id="service网络–NodePort"><a href="#service网络–NodePort" class="headerlink" title="service网络–NodePort"></a>service网络–NodePort</h2><p>（1）通过设置nodePort映射到物理机，同时设置Service的类型为NodePort：</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-19.png" alt="NodePort"></p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-21.png" alt="yaml配置"></p>
<h2 id="通过Loadbalance将服务暴露出来"><a href="#通过Loadbalance将服务暴露出来" class="headerlink" title="通过Loadbalance将服务暴露出来"></a>通过Loadbalance将服务暴露出来</h2><p>LoadBalancer 服务是暴露服务到 internet 的标准方式。在 GKE 上，这种方式会启动一个 Network Load Balancer[2]，它将给你一个单独的 IP 地址，转发所有流量到你的服务。</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-22.png" alt="Loadbalance"><br>这个方式的最大缺点是每一个用 LoadBalancer 暴露的服务都会有它自己的 IP 地址，每个用到的 LoadBalancer 都需要付费，这将是非常昂贵的。</p>
<h2 id="通过Ingress暴露服务"><a href="#通过Ingress暴露服务" class="headerlink" title="通过Ingress暴露服务"></a>通过Ingress暴露服务</h2><p>为什么使用Ingress，一个重要的原因是LoadBalancer服务都需要创建自己的负载均衡器，以及独有的公有Ip地址，而Ingress只需要一个公网Ip就能为许多服务提供访问。<br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-23.png" alt="Ingress"><br>Ingress 事实上不是一种服务类型。相反，它处于多个服务的前端，扮演着“智能路由”或者集群入口的角色。你可以用 Ingress 来做许多不同的事情，各种不同类型的 Ingress 控制器也有不同的能力。</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-24.png" alt="Ingress2"></p>
<h3 id="了解Ingress的工作原理"><a href="#了解Ingress的工作原理" class="headerlink" title="了解Ingress的工作原理"></a>了解Ingress的工作原理</h3><ul>
<li><p>1）ingress是kubernetes的一个资源对象，用于编写定义规则。</p>
</li>
<li><p>2）反向代理负载均衡器，通常以Service的Port方式运行，接收并按照ingress定义的规则进行转发，通常为nginx，haproxy，traefik等，本次使用nginx。</p>
</li>
<li><p>3）ingress-controller，监听apiserver，获取服务新增，删除等变化，并结合ingress规则动态更新到反向代理负载均衡器上，并重载配置使其生效。</p>
</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-25.png" alt="Ingress的工作原理"></p>
<ul>
<li>1.ingress controller通过和kubernetes api交互，动态的去感知集群中ingress规则变化，</li>
<li>2.然后读取它，按照自定义的规则，规则就是写明了哪个域名对应哪个service，生成一段nginx配置，</li>
<li>3.再写到nginx-ingress-control的pod里，这个Ingress controller的pod里运行着一个Nginx服务，控制器会把生成的nginx配置写入&#x2F;etc&#x2F;nginx.conf文件中，</li>
<li>4.然后reload一下使配置生效。以此达到域名分配置和动态更新的问题。</li>
</ul>
<h3 id="Ingress-可以解决什么问题"><a href="#Ingress-可以解决什么问题" class="headerlink" title="Ingress 可以解决什么问题"></a>Ingress 可以解决什么问题</h3><ul>
<li><p>1.动态配置服务<br>　　如果按照传统方式, 当新增加一个服务时, 我们可能需要在流量入口加一个反向代理指向我们新的k8s服务. 而如果用了Ingress, 只需要配置好这个服务, 当服务启动时, 会自动注册到Ingress的中, 不需要而外的操作.</p>
</li>
<li><p>2.减少不必要的端口暴露<br>　　配置过k8s的都清楚, 第一步是要关闭防火墙的, 主要原因是k8s的很多服务会以NodePort方式映射出去, 这样就相当于给宿主机打了很多孔, 既不安全也不优雅. 而Ingress可以避免这个问题, 除了Ingress自身服务可能需要映射出去, 其他服务都不要用NodePort方式</p>
</li>
</ul>
<p>通过相同的Ingress暴露多少服务</p>
<ul>
<li>1.将不同的服务映射到相同的主机不同的路径</li>
<li>2 将不同的服务映射到不同的主机上</li>
</ul>
<h3 id="安装Ingress"><a href="#安装Ingress" class="headerlink" title="安装Ingress"></a>安装Ingress</h3><ul>
<li>下载<a href="/download/ingress.zip">ingress脚本</a> ，解压<br>后上传至k8s master主机</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-26.png" alt="包含文件"></p>
<ul>
<li>运行ingress-nginx <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f mandatory.yaml</span><br></pre></td></tr></table></figure></li>
<li>配置ingress-nginx-svc.yaml 修改externalIPS ip 为k8s master 和k8s node节点ip</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-27.png" alt="ingress-nginx-svc.yaml"></p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f ingress-nginx.svc.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li><p>以下命令运行nginx 和kuboard镜像–目的测试ingress<br>创建kuboard 命名空间</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">apply</span> -f kuboard-<span class="keyword">namespace</span>.yaml</span><br></pre></td></tr></table></figure></li>
<li><p>创建nginx</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl  <span class="built_in">apply</span> -f nginx.yaml</span><br></pre></td></tr></table></figure></li>
<li><p>创建kuboard</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f kuboard.yaml</span><br></pre></td></tr></table></figure></li>
<li><p>获取token  </p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kuboard get secret <span class="constructor">$(<span class="params">kubectl</span> -<span class="params">n</span> <span class="params">kuboard</span> <span class="params">get</span> <span class="params">secret</span> | <span class="params">grep</span> <span class="params">kuboard</span>-<span class="params">user</span> | <span class="params">awk</span> &#x27;&#123;<span class="params">print</span> $1&#125;&#x27;)</span> -o go-template=&#x27;&#123;&#123;.data.token&#125;&#125;&#x27; <span class="pattern-match">| base64 -d</span></span><br><span class="line"><span class="pattern-match"></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>host文件设置 </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span>.<span class="number">31.59</span> apiserver<span class="selector-class">.demo</span> test<span class="selector-class">.nginx</span><span class="selector-class">.com</span>  test<span class="selector-class">.kuboard</span><span class="selector-class">.com</span> test<span class="selector-class">.nginx1</span><span class="selector-class">.com</span> test<span class="selector-class">.nginx2</span>.com</span><br></pre></td></tr></table></figure></li>
<li><p>配置<a target="_blank" rel="noopener" href="http://test.nginx.com/">http://test.nginx.com/</a> 访问nginx<br>kubectl apply -f ingress.yml</p>
</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-28.png" alt="test.nginx.com"></p>
<ul>
<li>配置 <a target="_blank" rel="noopener" href="http://test.nginx1.com/">http://test.nginx1.com/</a> 访问nginx <a target="_blank" rel="noopener" href="http://test.kuboard.com/">http://test.kuboard.com/</a> 访问 kuboard <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f ingress1.yml</span><br></pre></td></tr></table></figure>
<img src="/2022/08/22/K8S%E7%9F%A5/pasted-29.png" alt="test.nginx1.com"></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-30.png" alt="test.kuboard.com"></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://test.nginx2.com/nginx">http://test.nginx2.com/nginx</a> <a target="_blank" rel="noopener" href="http://test.nginx2.com/kuboard">http://test.nginx2.com/kuboard</a>  同一域名不同路径<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f ingress2.yml</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-31.png" alt="test.nginx2.com/nginx "></p>
<p>仅是模拟不同域名下不同路径 映射不同pod,正常访问kuboard 需要访问test.kuboard.com<br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-33.png" alt="http://test.nginx2.com/kuboard"></p>
<ul>
<li>获取ingress<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">get</span> ingress <span class="comment">--all-namespaces</span></span><br></pre></td></tr></table></figure></li>
<li>删除<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">delete</span> -f nginx.yaml</span><br><span class="line"></span><br><span class="line">kubectl <span class="keyword">delete</span> -f kuboard.yaml</span><br><span class="line">kubectl <span class="keyword">delete</span> -f ingress.yml</span><br><span class="line">kubectl <span class="keyword">delete</span> -f ingress1.yml</span><br><span class="line">kubectl <span class="keyword">delete</span> -f ingress2.yml</span><br><span class="line">kubectl <span class="keyword">delete</span> -f kuboard-<span class="keyword">namespace</span>.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="k8s-dns"><a href="#k8s-dns" class="headerlink" title="k8s-dns"></a>k8s-dns</h1><p>前面我们给大家讲解了 Service 的用法，我们可以通过 Service 生成的 ClusterIP(VIP)来访问 Pod 提供的服务，但是在使用的时候还有一个问题：我们怎么知道某个应用的 VIP 呢？比如我们有两个应用，一个是 api 应用，一个是 db 应用，两个应用都是通过 Deployment 进行管理的，并且都通过 Service 暴露出了端口提供服务。api 需要连接到 db 这个应用，我们只知道 db 应用的名称和 db 对应的 Service 的名称，但是并不知道它的 VIP 地址，我们前面的 Service 课程中是不是学习到我们通过 ClusterIP 就可以访问到后面的 Pod 服务，如果我们知道了 VIP 的地址是不是就行了？</p>
<p>那就是可以直接使用 Service 的名称，因为 Service 的名称不会变化，我们不需要去关心分配的 ClusterIP 的地址，因为这个地址并不是固定不变的，所以如果我们直接使用 Service 的名字，然后对应的 ClusterIP 地址的转换能够自动完成就很好了。我们知道名字和 IP 直接的转换是不是和我们平时访问的网站非常类似啊？他们之间的转换功能通过 DNS 就可以解决了，同样的，Kubernetes 也提供了 DNS 的方案来解决上面的服务发现的问题。<br>DNS 服务不是一个独立的系统服务，而是作为一种 addon 插件而存在，也就是说不是 Kubernetes 集群必须安装的，当然我们强烈推荐安装，可以将这个插件看成是一种运行在 Kubernetes 集群上的一直比较特殊的应用，现在比较推荐的两个插件：kube-dns 和 CoreDNS。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">get</span> pods -n kube-system -l <span class="attribute">k8s-app</span>=kube-dns -o wide</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-36.png" alt="core dns"></p>
<h1 id="PV和PVC"><a href="#PV和PVC" class="headerlink" title="PV和PVC"></a>PV和PVC</h1><p>*　管理存储是管理计算的一个明显问题。该PersistentVolume子系统为用户和管理员提供了一个API，用于抽象如何根据消费方式提供存储的详细信息。为此，我们引入了两个新的API资源：PersistentVolume和PersistentVolumeClaim</p>
<p>*　　PersistentVolume（PV）是集群中由管理员配置的一段网络存储。 它是集群中的资源，就像节点是集群资源一样。 PV是容量插件，如Volumes，但其生命周期独立于使用PV的任何单个pod。 此API对象捕获存储实现的详细信息，包括NFS，iSCSI或特定于云提供程序的存储系统。</p>
<p>　　PersistentVolumeClaim（PVC）是由用户进行存储的请求。 它类似于pod。 Pod消耗节点资源，PVC消耗PV资源。Pod可以请求特定级别的资源（CPU和内存）。声明可以请求特定的大小和访问模式<br>访问模式：</p>
<ul>
<li>ReadWriteOnce – the volume can be mounted as read-write by a single node</li>
<li>ReadOnlyMany – the volume can be mounted read-only by many nodes</li>
<li>ReadWriteMany – the volume can be mounted as read-write by many nodes</li>
</ul>
<p>*　　虽然PersistentVolumeClaims允许用户使用抽象存储资源，但是PersistentVolumes对于不同的问题，用户通常需要具有不同属性（例如性能）。群集管理员需要能够提供各种PersistentVolumes不同的方式，而不仅仅是大小和访问模式，而不会让用户了解这些卷的实现方式。对于这些需求，有StorageClass 资源。<br>*　　StorageClass为管理员提供了一种描述他们提供的存储的“类”的方法。 不同的类可能映射到服务质量级别，或备份策略，或者由群集管理员确定的任意策略。 Kubernetes本身对于什么类别代表是不言而喻的。 这个概念有时在其他存储系统中称为“配置文件”。<br>*　　PVC和PV是一一对应的。</p>
<h2 id="生命周期-Provisioning-——-gt-Binding-——–-gt-Using——-gt-Releasing——-gt-Recycling"><a href="#生命周期-Provisioning-——-gt-Binding-——–-gt-Using——-gt-Releasing——-gt-Recycling" class="headerlink" title="(生命周期)Provisioning ——-&gt; Binding ——–&gt;Using——&gt;Releasing——&gt;Recycling"></a>(生命周期)Provisioning ——-&gt; Binding ——–&gt;Using——&gt;Releasing——&gt;Recycling</h2><ul>
<li>供应准备Provisioning—通过集群外的存储系统或者云平台来提供存储持久化支持。</li>
</ul>
<ul>
<li>静态提供Static：集群管理员创建多个PV。 它们携带可供集群用户使用的真实存储的详细信息。 它们存在于Kubernetes API中，可用于消费</li>
<li>动态提供Dynamic：当管理员创建的静态PV都不匹配用户的PersistentVolumeClaim时，集群可能会尝试为PVC动态配置卷。 此配置基于StorageClasses：PVC必须请求一个类，并且管理员必须已创建并配置该类才能进行动态配置。 要求该类的声明有效地为自己禁用动态配置。</li>
</ul>
<ul>
<li>绑定Bound—用户创建pvc并指定需要的资源和访问模式。在找到可用pv之前，pvc会保持未绑定状态。</li>
<li>使用Using—用户可在pod中像volume一样使用pvc。</li>
<li>释放Releasing—用户删除pvc来回收存储资源，pv将变成“released”状态。由于还保留着之前的数据，这些数据需要根据不同的策略来处理，否则这些存储资源无法被其他pvc使用。</li>
<li>回收Recycling—pv可以设置三种回收策略：保留（Retain），回收（Recycle）和删除（Delete）。</li>
</ul>
<ul>
<li>保留策略：允许人工处理保留的数据。</li>
<li>删除策略：将删除pv和外部关联的存储资源，需要插件支持。</li>
<li>回收策略：将执行清除操作，之后可以被新的pvc使用，需要插件支持。</li>
</ul>
<ul>
<li>注：目前只有NFS和HostPath类型卷支持回收策略，AWS EBS,GCE PD,Azure Disk和Cinder支持删除(Delete)策略。</li>
</ul>
<h2 id="PV和PVC–以NFS为例子"><a href="#PV和PVC–以NFS为例子" class="headerlink" title="PV和PVC–以NFS为例子"></a>PV和PVC–以NFS为例子</h2><p>NFS（Network File System）即网络文件系统，它允许网络中的计算机之间通过TCP&#x2F;IP网络共享资源。在NFS的应用中，本地NFS的客户端应用可以透明地读写位于远端NFS服务器上的文件，就像访问本地文件一样。</p>
<ul>
<li>安装nfs-utils master node<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y <span class="built_in">nfs</span>-utils  rpcbind</span><br><span class="line">systemctl start rpcbind <span class="built_in">nfs</span></span><br><span class="line">systemctl enable  rpcbind <span class="built_in">nfs</span></span><br></pre></td></tr></table></figure></li>
<li>k8s主机设置nfs 共享<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/pv/</span>nginx</span><br><span class="line">cd <span class="regexp">/pv/</span>nginx</span><br><span class="line">vi index.html</span><br></pre></td></tr></table></figure></li>
<li>index.html内容<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.!!!!<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>设置共享盘 修改masterip<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>exports</span><br></pre></td></tr></table></figure></li>
<li>添加以下内容 后保存 换一下k8s masterip<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/pv/</span>nginx   <span class="number">192.168</span>.<span class="number">31.59</span>/<span class="number">24</span>(rw,sync)</span><br></pre></td></tr></table></figure></li>
<li>执行exportfs -arv<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">exportfs -arv</span></span><br></pre></td></tr></table></figure></li>
<li>k8s master node执行 换一下k8s masterip<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">showmount</span> -e <span class="number">192.168.31.59</span></span><br></pre></td></tr></table></figure></li>
<li>下载<a href="/download/pv.zip">pv.zip</a> ,解压后上传至k8s master</li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-32.png" alt="pv 文件"></p>
<ul>
<li>创建nginx命名空间<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">apply</span> -f nginx-<span class="keyword">namespace</span>.yaml</span><br></pre></td></tr></table></figure></li>
<li>查看命名空间<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">get</span> ns</span><br></pre></td></tr></table></figure></li>
<li>创建pv 记得修改masterip<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f nginxpv.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-37.png" alt="nginx pv"></p>
<ul>
<li>查看pv<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get <span class="built_in">pv</span> -<span class="built_in">n</span> nginx</span><br></pre></td></tr></table></figure></li>
<li>创建pvc<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f nginxpvc.yaml</span><br></pre></td></tr></table></figure></li>
<li>查看pvc<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">get</span> pvc -n nginx</span><br></pre></td></tr></table></figure></li>
<li>运行nginx <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">apply</span> -f nginx.yaml</span><br></pre></td></tr></table></figure></li>
<li>查看pod<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">get</span> pod -n nginx</span><br></pre></td></tr></table></figure></li>
<li>查看svc<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">kubectl</span> <span class="meta">get</span> <span class="keyword">svc</span> -n nginx</span><br></pre></td></tr></table></figure></li>
<li>查看ingress 信息<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">get</span> ingress -n nginx</span><br></pre></td></tr></table></figure></li>
<li>设置主机名：192.168.31.59 test.nginxpv.com</li>
<li>浏览器访问：<a target="_blank" rel="noopener" href="http://test.nginxpv.com/">http://test.nginxpv.com/</a></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-38.png" alt="test.nginxpv.com"></p>
<ul>
<li>删除<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">delete</span> -f nginx.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="helm"><a href="#helm" class="headerlink" title="helm"></a>helm</h1><p>我们在 k8s 中部署一个应用，通常面临以下几个问题：</p>
<ul>
<li>如何统一管理、配置和更新这些分散的 k8s 的应用资源文件</li>
<li>如何分发和复用一套应用模板</li>
<li>如何将应用的一系列资源当做一个软件包管理</li>
</ul>
<h2 id="Helm-管理-k8s集群"><a href="#Helm-管理-k8s集群" class="headerlink" title="Helm 管理 k8s集群"></a>Helm 管理 k8s集群</h2><p>Helm 可以理解为 Kubernetes 的包管理工具，可以方便地发现、共享和使用为Kubernetes构建的应用。<br>Helm 采用客户端&#x2F;服务器架构，有如下组件组成：</p>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-34.png" alt="helm"><br>Helm CLI 是 Helm 客户端，可以在本地执行</p>
<p>Tiller 是服务器端组件，在 Kubernetes 群集上运行，并管理 Kubernetes 应用程序的生命周期</p>
<p>Repository 是 Chart 仓库，Helm客户端通过HTTP协议来访问仓库中Chart的索引文件和压缩包。</p>
<p>chart Helm的打包格式叫做chart，所谓chart就是一系列文件, 它描述了一组相关的 k8s 集群资源</p>
<p>release 使用 helm install 命令在 Kubernetes 集群中部署的 Chart 称为 Release</p>
<h2 id="mac安装"><a href="#mac安装" class="headerlink" title="mac安装"></a>mac安装</h2><ul>
<li>k8s master主机下<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">create</span> serviceaccount --<span class="keyword">namespace</span> kube-<span class="keyword">system</span> tiller</span><br></pre></td></tr></table></figure>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding <span class="keyword">default</span>-view --clusterrole=<span class="keyword">cluster</span>-admin --serviceaccount=<span class="keyword">default</span>:<span class="keyword">default</span></span><br></pre></td></tr></table></figure>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="keyword">create</span> clusterrolebinding tiller-<span class="keyword">cluster</span>-admin --clusterrole=<span class="keyword">cluster</span>-admin --serviceaccount=kube-<span class="keyword">system</span>:tiller</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-39.png" alt="kubectl tiller"></p>
<ul>
<li>copy master上 &#x2F;root&#x2F;.kube&#x2F;onfig文件至mac 用户目录下.kube&#x2F;</li>
<li>下载 mac 版本helm<br><a target="_blank" rel="noopener" href="https://get.helm.sh/helm-v2.15.0-darwin-amd64.tar.gz">https://get.helm.sh/helm-v2.15.0-darwin-amd64.tar.gz</a><br>其它版本：<a target="_blank" rel="noopener" href="https://github.com/helm/helm/releases/tag/v2.15.0">https://github.com/helm/helm/releases/tag/v2.15.0</a></li>
<li>mac电脑 下载解压后<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp helm <span class="regexp">/usr/</span>local/bin</span><br><span class="line">chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>helm</span><br></pre></td></tr></table></figure></li>
<li>mac命令执行<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm init <span class="attr">--service-account</span> tiller <span class="attr">--upgrade</span> <span class="attr">--tiller-image</span>=registry<span class="selector-class">.cn-hangzhou</span><span class="selector-class">.aliyuncs</span>.com/google_containers/tiller:v2.<span class="number">15.1</span> <span class="attr">--stable-repo-url</span> https:<span class="comment">//kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-40.png" alt="helm init"></p>
<ul>
<li>成功后 查看helm 版本<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="built_in">version</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-41.png" alt="helm version"></p>
<h2 id="helm-chart-的基本结构"><a href="#helm-chart-的基本结构" class="headerlink" title="helm chart 的基本结构"></a>helm chart 的基本结构</h2><ul>
<li>helm create nginxhelm<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm create nginxhelm</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-43.png" alt="nginxhelm 目录"></p>
<p>charts 目录存放依赖的chart</p>
<p>Chart.yaml 包含Chart的基本信息，包括chart版本，名称等</p>
<p>templates 目录下存放应用一系列 k8s 资源的 yaml 模板<br>_helpers.tpl 此文件中定义一些可重用的模板片断，此文件中的定义在任何资源定义模板中可用</p>
<p>NOTES.txt 介绍chart 部署后的帮助信息，如何使用chart等</p>
<p>values.yaml 包含了必要的值定义（默认值）, 用于存储 </p>
<p>templates 目录中模板文件中用到变量的值</p>
<h2 id="helm-部署"><a href="#helm-部署" class="headerlink" title="helm 部署"></a>helm 部署</h2><ul>
<li>检查 语法<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm</span> lint nginxhelm/ </span><br></pre></td></tr></table></figure>
<img src="/2022/08/22/K8S%E7%9F%A5/pasted-44.png" alt="helm lint nginxhelm"></li>
<li>打包：<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="keyword">package</span> <span class="title">nginxhelm --debug</span></span><br></pre></td></tr></table></figure></li>
<li>部署<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install nginxhelm <span class="comment">--name nginxhelm</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-46.png" alt="helm install "></p>
<ul>
<li>在k8s节点进行访问 curl <a target="_blank" rel="noopener" href="http://clusterip/">http://clusterip</a></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-47.png" alt="访问"></p>
<h2 id="helm（升级-和回退）"><a href="#helm（升级-和回退）" class="headerlink" title="helm（升级 和回退）"></a>helm（升级 和回退）</h2><ul>
<li><p>修改：Chart.yaml version 0.2.1–&gt;0.2.2<br><img src="/2022/08/22/K8S%E7%9F%A5/pasted-48.png" alt="Chart.yaml"></p>
</li>
<li><p>打包：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="keyword">package</span> <span class="title">nginxhelm --debug</span></span><br></pre></td></tr></table></figure></li>
<li><p>查看版本信息：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm search nginxhelm -l</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>升级</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm upgrade nginxhelm nginxhelm</span> </span><br></pre></td></tr></table></figure>
<p>(helmproject项目有什么更改都可以通过upgrade进行更新k8s)</p>
</li>
<li><p>查看已经升级到最新版本</p>
 <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm list</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-49.png" alt=" helm list"></p>
<ul>
<li>回退： <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helm</span> rollback nginxhelm <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-50.png" alt="helm rollback 后查看helm list"></p>
<ul>
<li>删除<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm <span class="built_in">delete</span> <span class="comment">--purge nginxhelm </span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="helm-常用命令"><a href="#helm-常用命令" class="headerlink" title="helm 常用命令"></a>helm 常用命令</h2><p><img src="/2022/08/22/K8S%E7%9F%A5/pasted-42.png" alt="图片/2022/08/22/K8S知/pasted-42.png"></p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><ul>
<li>k8s 教程：<a target="_blank" rel="noopener" href="https://www.kubernetes.org.cn/doc-11">https://www.kubernetes.org.cn/doc-11</a></li>
<li>k8s 安装：<a target="_blank" rel="noopener" href="https://kuboard.cn/install/install-dashboard.html">https://kuboard.cn/install/install-dashboard.html</a></li>
<li>k8s pc&#x2F;PVC:<a target="_blank" rel="noopener" href="http://www.mamicode.com/info-detail-1523110.html">http://www.mamicode.com/info-detail-1523110.html</a></li>
</ul>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>Kubernetes知识</p><p><span>文章作者：</span>peter.tan</p><p><span>发布时间：</span>2022-08-22</p><p><span>最后更新：</span>2022-09-05</p><p><span>原始链接：</span><a href="/2022/08/22/K8S知识/">https://petertanblog.github.io/2022/08/22/K8S%E7%9F%A5%E8%AF%86/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://petertanblog.github.io/2022/08/22/K8S%E7%9F%A5%E8%AF%86/"></i></span></p><p><span>版权声明：</span>Copyright © 2022 Peter.tan</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://petertanblog.github.io/2022/08/22/K8S%E7%9F%A5%E8%AF%86/" data-id="cl7m10mgi000rt55kculv5hya" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACu0lEQVR42u3a0W4iMQwF0P7/T7fSvtIZ7o0TOtKeeUIgkpwgJcb211f8fP97Xt95fa6+df/p65jJ+9sePDw8vKWl3y/39fX9p1eAqxmTT6/WcD8aHh4e3jne/WWQL7S9MJIZ76lvRsbDw8P7U959aJuEvO1C164cPDw8vOfw2lRCsiltGI2Hh4f3HF6SjGhTA3XiYGk923IteHh4eN2YRQHsCa8P1vfw8PDwBlX1Ni3bTp9cPKMV4uHh4R3gzVua5k0A7RryRDAeHh7eCV67uCRJkTcB5Pi1zcLDw8M7wdt1fLelsiTIzottb7YGDw8PbyvvXLJ1LTieNBx8NPeMh4f3H/MmYWv7r3/SZNCmffHw8PDO8eZNVMmm5AH3rk3Ew8PDO8dba3JqJ2gTxHk4vq1fDA8PD2+J1x70OTJPK7SpjeL2w8PDwzvGy5sJJtOvFcnyC+xN6wAeHh7emJcPtBZ2t9u3Bq5z1Xh4eHhLvL3Vs8loedmsuCTw8PDwDvDyJGxb1M/D6ElwXPwAeHh4eJt4bfGpPaDzxdXJ2WSFeHh4eMd4+RcmYfekVLYYjuPh4eEd4O1NFtwvJQ/Hk9nrNAQeHh7eJl5+WN9P35ap2paFtiR2ee/h4eHhjXmTsn0edhc9C0uM6CLBw8PDO8BLlttOljen5tdPfs3g4eHhfYa3eNSWBbNd29EG93h4eHi7eHkKYFKyyr81SVJc/lfAw8PDO8zbxZiUr+ZpYjw8PLwTvO/yqQ/lwVWRh9F4eHh4n+S1aYVkKflVkaQS1lq78PDw8E7zdjWV5gd6ux3JxXA5Dh4eHt4x3lq4nLDbpEN7g+Hh4eE9n5eT7t9Zq/XnaWU8PDy8J/DWSv5tunYSQOPh4eF9kpekDNaWslZym4TpeHh4eKd5awWwXYmMvN0qafnaVt/Dw8PD+320H45yXpPcKLYQAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/Kubernetes"><i class="fa fa-tag">Kubernetes</i></a></div><div class="post-nav"><a class="pre" href="/2022/08/26/Spring/">Spring</a><a class="next" href="/2022/08/21/Docker%E7%9F%A5%E8%AF%86/"></a></div><script src="https://utteranc.es/client.js" repo="peterTanBlog/blog_comments" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/images/head.jpg"/></a><p>我喜欢计算编程,专注后端开发 性能调优 spring 框架 spring boot docker k8s</p><a class="info-icon" href="mailto:beityw@hotmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/peterTanBlog/" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Centos/">Centos</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Hexo-admin/" style="font-size: 15px;">Hexo admin</a> <a href="/tags/hexo-%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2/" style="font-size: 15px;">hexo 站内搜索</a> <a href="/tags/hexo-%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo 百度统计</a> <a href="/tags/hexo-google%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo google统计</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E6%94%B6%E5%BD%95hexo%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">百度收录hexo博客</a> <a href="/tags/google%E6%94%B6%E5%BD%95hexo-%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">google收录hexo 博客</a> <a href="/tags/maupassant-%E4%B8%BB%E9%A2%98/" style="font-size: 15px;">maupassant 主题</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/utterances-%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">utterances 评论插件</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/mysql%E9%87%8D%E7%BD%AEroot%E5%AF%86%E7%A0%81/" style="font-size: 15px;">mysql重置root密码</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9Root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改Root密码</a> <a href="/tags/Mysql-%E5%BC%80%E5%90%AF%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/" style="font-size: 15px;">Mysql 开启用户远程访问</a> <a href="/tags/Mysql-%E7%BB%BF%E8%89%B2%E7%89%88%E5%AE%89%E8%A3%85/" style="font-size: 15px;">Mysql 绿色版安装</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改root密码</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">微服务</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring cloud</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/Junit5/" style="font-size: 15px;">Junit5</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/09/09/Linux/">Centos Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/09/Junittest/">Junittest</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/08/windows-%E6%8A%80%E5%B7%A7/">windows 技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/05/JVM/">JVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/26/Spring/">Spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/22/K8S%E7%9F%A5%E8%AF%86/">Kubernetes知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/21/Docker%E7%9F%A5%E8%AF%86/">Docker知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/21/Mac%E6%8A%80%E5%B7%A7/">Mac技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/18/IDEA%E6%8A%80%E5%B7%A7/">IDEA技巧</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://smallwenzi.github.io" title="我的博客" target="_blank">我的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">perter blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>