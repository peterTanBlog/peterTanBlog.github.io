<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="perter的技术分享"><meta name="keywords" content="spring cloud,微服务特点,微服务好处,什么是微服务,单体架构"><title>微服务 | perter blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-MDFK5LR2L9" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MDFK5LR2L9');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '51cd3d8b2f315ceeb62cbeda68c1d672';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">微服务</h1><a id="logo" href="/.">perter blog</a><p class="description">perter的技术分享</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">微服务</h1><div class="post-meta">2022-09-03<span> | </span><span class="category"><a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.4k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 21</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">单体架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LTMJ%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A4%BA"><span class="toc-number">1.1.</span> <span class="toc-text">LTMJ应用服务器示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">单体架构有什么问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%93%E5%BA%94%E7%94%A8%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">单体应用集群架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">什么是微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8D%95%E5%85%83%E6%8C%89%E4%B8%9A%E5%8A%A1%E6%8B%86%E5%88%86"><span class="toc-number">2.1.</span> <span class="toc-text">微服务单元按业务拆分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%80%9A%E8%BF%87HTTP%E6%9D%A5%E4%BA%92%E7%9B%B8%E9%80%9A%E4%BF%A1"><span class="toc-number">2.2.</span> <span class="toc-text">微服务通过HTTP来互相通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8B%AC%E7%AB%8B"><span class="toc-number">2.3.</span> <span class="toc-text">微服务的数据库独立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-number">2.4.</span> <span class="toc-text">微服务的自动化部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">服务集中化管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84"><span class="toc-number">2.6.</span> <span class="toc-text">分布式架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6"><span class="toc-number">2.7.</span> <span class="toc-text">熔断机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%98%E5%8A%BF"><span class="toc-number">3.</span> <span class="toc-text">微服务优势</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%8D%E8%B6%B3"><span class="toc-number">4.</span> <span class="toc-text">微服务的不足</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%B9%E7%82%B9"><span class="toc-number">5.</span> <span class="toc-text">微服务特点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C%E4%B8%8E%E6%B6%88%E8%B4%B9"><span class="toc-number">5.1.</span> <span class="toc-text">服务的注册与消费</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">5.2.</span> <span class="toc-text">服务的负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%B9%E9%94%99"><span class="toc-number">5.3.</span> <span class="toc-text">服务的容错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3"><span class="toc-number">5.4.</span> <span class="toc-text">服务网关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E7%9A%84%E7%BB%9F%E4%B8%80%E7%AE%A1%E7%90%86"><span class="toc-number">5.5.</span> <span class="toc-text">服务配置的统一管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA"><span class="toc-number">5.6.</span> <span class="toc-text">服务链路跟踪</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Cloud"><span class="toc-number">6.</span> <span class="toc-text">Spring Cloud</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud"><span class="toc-number">6.1.</span> <span class="toc-text">SpringCloud</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">构建微服务</span></a></li></ol></div></div><div class="post-content"><h1 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h1><ul>
<li><p>在软件设计中，经常提及和使用经典3层模型，即表示层、业务逻辑层、数据访问层。</p>
</li>
<li><p>表示层：用于直接和用户交互，也称为交互层，通常是网页、UI等</p>
</li>
<li><p>业务逻辑层：即业务逻辑处理层，例如用户输入的信息要经过业务逻辑层的处理后才能展现给用户</p>
</li>
<li><p>数据访问层：用于操作数据库，用户在表示层会产生大量的数据，通过数据访问层对数据库进行读写操作</p>
</li>
<li><p>一个经典的单体应用就是将所有的业务场景的表示层、业务逻辑层和数据访问层放在一个工程中最终经过编译、打包，部署在一台服务器上。</p>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-1.png" alt="经典单体架构"></p>
<h2 id="LTMJ应用服务器示"><a href="#LTMJ应用服务器示" class="headerlink" title="LTMJ应用服务器示"></a>LTMJ应用服务器示</h2><p>如左图所示，LTMJ系统即是<br>服务器是linux系统，<br>开发应用程序语言是JAVA,<br>部署在Tomcat上，<br>采用MySQL数据库<br><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-2.png" alt="LTMJ应用服务器示意图"></p>
<h2 id="单体架构有什么问题"><a href="#单体架构有什么问题" class="headerlink" title="单体架构有什么问题"></a>单体架构有什么问题</h2><ul>
<li><p>1.复杂性逐渐变高</p>
<p>业务越来越复杂，单体应用的代码量越来越大，代码可读性、可维护性、可扩展性下降，新人接手代码所需的时间成倍增加，业务扩展带来的代价越来越大</p>
</li>
<li><p>2.单体应用并发能力有限</p>
</li>
</ul>
<p> 随着用户越来越多，程序承受的并发越来越高，单体应用的并发能力有限</p>
<ul>
<li>3.测试难度大</li>
</ul>
<p>单体应用的业务都在用一个程序中，随着业务的扩张、复杂度的增加，单体应用的修改或添加业务和或许会给其他业务带来一定的影响，导致测试难度增加</p>
<h2 id="单体应用集群架构"><a href="#单体应用集群架构" class="headerlink" title="单体应用集群架构"></a>单体应用集群架构</h2><p>1 系统仍然为单体应用</p>
<p>2 面对海量用户，数据库将会成为瓶颈，解决方案：分布式数据库，分库分表</p>
<p>3 持续交付能力差，业务越来越复杂，代码越多，修改的和添加代码所需时间长，新人熟悉代码时间长，成本高</p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-3.png" alt="单体应用集群架构"></p>
<h1 id="什么是微服务"><a href="#什么是微服务" class="headerlink" title="什么是微服务"></a>什么是微服务</h1><ul>
<li>微服务最早由Martin Fowler与James Lewis于2014年共同提出，微服务架构风格是一种使用一套小服务来开发单个应用的方式途径，每个服务运行在自己的进程中，并使用轻量级机制通信，通常是HTTP API，这些服务基于业务能力构建，并能够通过自动化部署机制来独立部署，这些服务使用不同的编程语言实现，以及不同数据存储技术，并保持最低限度的集中式管理。</li>
<li>微服务的特性：<ul>
<li>按业务拆分为一个独立运行的程序，即服务单元</li>
<li>服务之间通过HTTP协议相互通讯</li>
<li>自动化部署</li>
<li>可以使用不同编程语言</li>
<li>可以使用不同存储技术</li>
<li>服务集中化管理</li>
<li>微服务是一个分布式系统</li>
</ul>
</li>
</ul>
<h2 id="微服务单元按业务拆分"><a href="#微服务单元按业务拆分" class="headerlink" title="微服务单元按业务拆分"></a>微服务单元按业务拆分</h2><ul>
<li><p>微服务的“微”是按照业务拆分，一个大的业务可以拆分成若干的小的业务，一个小的业务又可以拆分成若干更小的业务，业务怎么拆分是有开发人员自己决定</p>
</li>
<li><p>按业务划分的微服务单元独立部署，运行在独立的进程中。这些微服务是高度组件化的模块，并提供了稳定额模块边界，服务与服务之间没有任何的耦合，有非常好的扩展性和复用性。</p>
</li>
<li><p>现有我们开发模式通常由UI团队、服务端团队、数据库和运维团队构成，每个人各司其职，很少跨职能工作。</p>
</li>
<li><p>现在按照业务来划分服务，每个服务都需要UI、服务端、数据库和运维。也就是说一个小的业务的微服务需要动用一个团队的人协作，这显然添加了团队和团队之间交流协作的成本，所以产生了跨职能团队，这个团队复杂一个服务的所有工作，包括UI，服务端和数据库。若这个团队只有1-2个人，就对开发人员提出更高的要求</p>
</li>
</ul>
<h2 id="微服务通过HTTP来互相通信"><a href="#微服务通过HTTP来互相通信" class="headerlink" title="微服务通过HTTP来互相通信"></a>微服务通过HTTP来互相通信</h2><ul>
<li><p>按照业务拆分的微服务反应独立部署，并允许在各自的进程中。</p>
</li>
<li><p>微服务单元之间的通信方式一般倾向于使用HTTP这种简单的通信机制，更多时候是使用RESTfulAPI</p>
</li>
<li><p>服务与服务之间也可以通过轻量级的消息总线来通信，例如RabbitMQ、Kafaka.通过发送消息或订阅消息来达到服务与服务之间通信的目的</p>
</li>
<li><p>这两种方式有弊端：其通信机制是不可靠的，虽然成功率很高，但还是会有失败的时候</p>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-4.png" alt="微服务通过HTTP来互相通信">
    </p>
<h2 id="微服务的数据库独立"><a href="#微服务的数据库独立" class="headerlink" title="微服务的数据库独立"></a>微服务的数据库独立</h2><ul>
<li>例如 一个应用有这样的几个业务：用户的信息、用户的账户，用户购物车、素报表服务等，所有业务都共用一个数据库，随着业务量的添加，数据库的表数量越来越多，难以管理和维护，并且数据量的添加会导致查询速度越来越慢。</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-5.png" alt="单体架构"></p>
<ul>
<li>每个微服务都有自己的数据库，他们之间数据库是没有联系。每个服务所使用的数据库存储技术å是根据业务需求决定<br><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-6.png" alt="微服务"></li>
</ul>
<h2 id="微服务的自动化部署"><a href="#微服务的自动化部署" class="headerlink" title="微服务的自动化部署"></a>微服务的自动化部署</h2><ul>
<li>自动化部署可以提供部署的效率，减少人为的控制，部署过程中出现的错误的概率降低，提供软件的质量</li>
<li>构建一个自动化部署的系统，虽然在前期需要开发人员或运维人员学习</li>
<li>随着客户实施DevOps，自动化部署必然会成为微服务部署一种方式<br>如果微服务按照单体架构的部署方式，则部署难度会呈指数增加。随着技术的发展，Docker容器技术、Kubernetes技术的推进，以及自动化部署工具（Jenkins）出现，自动化部署变得越来越简单</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-7.png" alt="微服务的自动化部署"></p>
<h2 id="服务集中化管理"><a href="#服务集中化管理" class="headerlink" title="服务集中化管理"></a>服务集中化管理</h2><ul>
<li>微服务系统是按业务单元来划分，服务数量越多，管理起来就越复杂，因此微服务必须使用集中化管理。目前流行的微服务框架中，例如Spring cloud 采用Eureka来注册服务</li>
</ul>
<h2 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h2><ul>
<li>分布式系统是集群部署，由很多计算机相互协作共同构成，它能够处理海量用户的请求，当分布式系统对外提供服务时，用户是毫不知情的，还以为是一台服务器在提供服务。</li>
<li>微服务架构是分布式架构，是集群化部署，会给数据一致性带来困难，分布式系统中的服务通信依赖于网络，网络不好，必然会对分布式系统带来很大的影响，在分布式系统中服务之间相互依赖，如果一个服务出现了故障或网络延迟，在高并发的情况下，会导致线程阻塞，在很短时间内该服务的线程资源会消耗殆尽，最终服务不可用，由于服务的相互依赖，可能会导致整个系统不可用，这就是“雪崩效应”，为了防止此类事件的发生，分布式系统必然要采取相应的措施，例如熔断机制。</li>
</ul>
<h2 id="熔断机制"><a href="#熔断机制" class="headerlink" title="熔断机制"></a>熔断机制</h2><ul>
<li>为了防止雪崩效应事件的发生，分布式系统采用熔断机制。在用Spring cloud构建的微服务系统中，采用了熔断器（即Hystrix组建的Circuit breaker）去做熔断</li>
<li>例如在微服务系统中 有a、b、c、d等多个微服务，用户的请求通过网关后再到具体的服务，服务之间相互依赖，例如服务b依赖服务d，一个对外暴露的API需要服务b和服务d相互协作才能完成</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-8.png" alt="微服务"><br>如果此时服务b出现故障或者网络延迟在高并发的情况下，服务b会出现大量的线程阻塞，有可能在很短时间内线程资源就会被耗尽，导致服务b的不可用。<br>如果此时没有熔断机制就会导致雪崩效应<br>为了解决此问题，引入熔断机制：</p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-9.png" alt="b服务故障"></p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-10.png" alt="b服务熔断"></p>
<ul>
<li>熔断机制<br>主要在三种状态中转换：</li>
<li>关闭状态 ：</li>
</ul>
<p> 当熔断器处于关闭状态时，请求是可以被放行的；<br> 当熔断器统计的失败次数触发开关时，转为打开状态。</p>
<ul>
<li>打开状态 ：</li>
</ul>
<p>当熔断器处于打开状态时，所有请求都是不被放行的，直接返回失败；<br>只有在经过一个设定的时间窗口周期后，熔断器才会转换到半开状态</p>
<ul>
<li>半开状态 ：</li>
</ul>
<p>当熔断器处于半开状态时，当前只能有一个请求被放行；<br>这个被放行的请求获得远端服务的响应后，假如是成功的，熔断器转换为关闭状态，否则转换到打开状态。</p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-11.png" alt="熔断机制"></p>
<h1 id="微服务优势"><a href="#微服务优势" class="headerlink" title="微服务优势"></a>微服务优势</h1><ul>
<li><p>微服务是松藕合的，无论是在开发阶段或部署阶段都是独立的。</p>
</li>
<li><p>能够快速响应, 局部修改容易, 一个服务出现问题不会影响整个应用。</p>
</li>
<li><p>易于和第三方应用系统集成, 支持使用不同的语言开发, 允许你利用融合最新技术。</p>
</li>
<li><p>每个微服务都很小，足够内聚，足够小，代码容易理解。团队能够更关注自己的工作成果, 聚焦指定的业务功能或业务需求。</p>
</li>
<li><p>开发简单、开发效率提高，一个服务可能就是专一的只干一件事, 能够被小团队单独开发，这个小团队可以是 2 到 5 人的开发人员组成。</p>
</li>
</ul>
<h1 id="微服务的不足"><a href="#微服务的不足" class="headerlink" title="微服务的不足"></a>微服务的不足</h1><ul>
<li><p>微服务的复杂度</p>
<p> 开发人员需要付出一定的学习成本去掌握更多架构知识和框架知识；另外服务与服务之间是相互依赖，若修改一个服务就会对另外一个服务产生影响；</p>
</li>
<li><p>分布式事务</p>
<p>   在微服务架构应用中，需要更新不同服务所使用的不同的数据库</p>
</li>
<li><p>服务的划分</p>
<p>如何拆分服务</p>
</li>
<li><p>服务的部署</p>
<p> 需要对微服务有足够强的控制力，及自动化部署（例如使用阿里云提供paas服务）</p>
</li>
</ul>
<h1 id="微服务特点"><a href="#微服务特点" class="headerlink" title="微服务特点"></a>微服务特点</h1><p>根据微服务的特点，一个微服务应该有以下功能</p>
<ul>
<li>服务的注册和发现</li>
<li>服务的负载均衡 </li>
<li>服务的容错</li>
<li>服务的网关</li>
<li>服务配置的统一管理</li>
<li>链路跟踪</li>
<li>实时日志</li>
</ul>
<h2 id="服务的注册与消费"><a href="#服务的注册与消费" class="headerlink" title="服务的注册与消费"></a>服务的注册与消费</h2><ul>
<li><p>微服务系统是由很多个单一职责的服务单元组成，需要服务注册中心类统一管理这些微服务实例，方便查看每个微服务实例的健康状态。</p>
</li>
<li><p>服务注册是指向服务注册中心注册一个服务实例，服务提供者将自己的服务信息（服务名、IP地址）告知服务注册中心。</p>
</li>
<li><p>服务发现是指当服务消费者需要消费另外一个服务时，服务注册中心能够告知服务消费者它所要消费服务的实例信息（如服务名，IP地址等）</p>
</li>
<li><p>服务消费者一般使用HTTP协议来进行服务消费</p>
</li>
<li><p>服务注册中心会提供服务的健康检查方案，检查被注册的服务是否可用</p>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-12.png" alt="服务的注册与消费"></p>
<h2 id="服务的负载均衡"><a href="#服务的负载均衡" class="headerlink" title="服务的负载均衡"></a>服务的负载均衡</h2><ul>
<li><p>在微服务架构中，服务之间的相互调用一般是通过HTTP通信协议来实现。但网络往往不可靠，为了保证服务的高可用，服务单元往往集群化部署。那服务消费者该调用哪个服务提供者的实例呢？</p>
</li>
<li><p>如图所示：所有服务都向服务注册中心注册（IP，服务名），服务消费者集成负载均衡组件，该组件会向服务消费者获取服务的注册列表信息，每隔一段时间重现刷新获取改列表。当服务消费者消费服务时，负载均衡组件获取服务提供者所有实例注册信息，并通过一定的负载均衡策略，选择一个服务提供者的实例，向该实例进行服务消费。</p>
</li>
<li><p>另外服务注册中心不但需要定时接收每个服务的心跳（用来检查服务是否可用），而且每个服务会定期获取服务注册列表的信息，当服务实例数量很多，服务注册中心承担了非常大的负载。由于服务注册中心很重要，所以必须实现高可用。</p>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-13.png" alt="服务的负载均衡"></p>
<h2 id="服务的容错"><a href="#服务的容错" class="headerlink" title="服务的容错"></a>服务的容错</h2><p><a href="/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/#%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6">熔断机制</a></p>
<h2 id="服务网关"><a href="#服务网关" class="headerlink" title="服务网关"></a>服务网关</h2><ul>
<li><p>微服务系统接口资源通常由服务网关统一暴露，内部服务不直接对外提供API资源的暴露。</p>
</li>
<li><p>网关的作用</p>
<ul>
<li>统一暴露微服务系统对外服务的接口</li>
<li>用户身份认证、权限认证</li>
<li>实现监控功能，实时日志输出，对请求进行记录</li>
<li>流量监控，在高并发的情况，对服务进行降级</li>
</ul>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-14.png" alt="服务网关"></p>
<h2 id="服务配置的统一管理"><a href="#服务配置的统一管理" class="headerlink" title="服务配置的统一管理"></a>服务配置的统一管理</h2><ul>
<li>在微服务架构中，需要有统一管理配置文件的组件，例如Spring cloud的config,阿里Nacos</li>
</ul>
<p>如图所示：<br>    * 1 ）首先Config server读取配置文件仓库的配置信息，仓库可以是本地仓库或git</p>
<pre><code>* 2） 配置服务启动时，读取配置文件信息，缓存在内存中

* 3 ）由于a、b、c等服务指定了向配置服务读取配置信息，所以这些服务启动时就会向配置中心读取配置
</code></pre>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-15.png" alt="服务配置的统一管理"></p>
<h2 id="服务链路跟踪"><a href="#服务链路跟踪" class="headerlink" title="服务链路跟踪"></a>服务链路跟踪</h2><ul>
<li><p>微服务系统有很多个服务，且服务与服务之间的调用有可能很复杂，一旦出现异常和错误很难定位。</p>
</li>
<li><p>所以微服务架构中必须实现分布式链路跟踪，去跟进一个请求到底有哪些服务参与，参与的顺序又是怎么样的。从而使每个请求链路清晰可见</p>
</li>
<li><p>如果所示 一个接口首先调服务A，后再调用B，而B需要调用C，对于这样一个请求需要三个服务，怎么样将它的请求过程的数据记录下，这就需要服务链路跟踪</p>
</li>
<li><p>目前链路跟踪组件：Google的Dapper、Twitter的Zipkin</p>
</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-16.png" alt="服务链路跟踪"></p>
<h1 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h1><p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-17.png" alt="Spring Cloud"></p>
<h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><ul>
<li>SpringCloud是基于Spring boot的。而Spring boot是简化了Spring的复杂的配置和依赖管理，从而提高在开发和部署上的效率。</li>
<li>目标：通过一系列的开发组件和框架，帮助开发者迅速搭建一个分布式的微服务系统。<br>常用组件：</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-18.png" alt="组件1"></p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-19.png" alt="组件2"></p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-20.png" alt="简单微服务"></p>
<h1 id="构建微服务"><a href="#构建微服务" class="headerlink" title="构建微服务"></a>构建微服务</h1><ul>
<li>开发环境：Jdk1.8,MAVEN3.2.3,Eclipse</li>
<li>spring cloud版本：Greenwich.SR2</li>
<li>Spring boot：2.1.6.RELEASE</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-21.png" alt="微服务"></p>
<ul>
<li>部署环境：<ul>
<li>k8s matser: 2核cpu 系统 cenots 7.9 硬盘20g 内存2048m ip:192.168.31.59 docker版本:18.09.7,k8s:1.15.1</li>
</ul>
</li>
<li>k8s node :2核cpu 系统 cenots 7.9 硬盘20g 内存3072 m ip:192.168.31.181 docker版本:18.09.7,k8s:1.15.1</li>
<li>docker：CPU1个，内存521M硬盘20G, 含有JAVA和MAVEN环境 镜像仓库使用阿里云</li>
<li>部署说明<br>下载[soft.zip]链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1jp2UuZUX-DtpVz51ucsAFA">https://pan.baidu.com/s/1jp2UuZUX-DtpVz51ucsAFA</a> 提取码: 3ahf<br>百度网盘不能下载请及时联系</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-24.png" alt="soft.zip"><br><a href="/download/springcloud.zip">springcloud.zip</a></p>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-25.png" alt="springcloud.zip"></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">------------------------------使用阿里云镜像仓库----</span><br><span class="line"><span class="comment">#上传soft文件至docker,k8smaster k8snode</span></span><br><span class="line"><span class="comment">#将镜像推送至ali,ali免费版可以存300个</span></span><br><span class="line">https:<span class="regexp">//</span>help.aliyun.com<span class="regexp">/document_detail/</span><span class="number">60945</span>.html?spm=a2c4g.<span class="number">11186623.6</span>.<span class="number">542.48983</span>d31EbMHWT</span><br><span class="line"><span class="comment">#1)仅是安装docker 环境（下载soft文件 解压后上传docker机器上root 目录 ，soft目录下installDocker.sh）</span></span><br><span class="line"><span class="comment">#docker version:18.09.7 k8s version:1.15.1</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installDocker.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh  init installDocker</span><br><span class="line"><span class="comment">#登录阿里云：</span></span><br><span class="line"><span class="comment"># docker login --username=test@1594726148325608 registry.cn-shenzhen.aliyuncs.com</span></span><br><span class="line"><span class="comment">#密码：t12345678</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#RAM用户控制台：</span></span><br><span class="line"> <span class="comment">#test@1594726148325608.onaliyun.com</span></span><br><span class="line"> <span class="comment">#密码：4DzBf)xUvq8hzY6B6QMlFR&#123;K?Oq(rsNv</span></span><br><span class="line"> <span class="comment">#https://cr.console.aliyun.com/cn-shenzhen/instance/repositories</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#2)导入镜像：</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installDocker.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh  loadJavaDockerImage</span><br><span class="line"></span><br><span class="line"> <span class="comment">#3)配置java环境：</span></span><br><span class="line"> <span class="comment">##配置java环境和MAVEN(maven库：/mavenFactory/repository)</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installDocker.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallDocker_new.sh    configJava</span><br><span class="line"></span><br><span class="line"> <span class="comment">#4)build docker 新打开一个窗口执行 上传sprincloud代码至/root</span></span><br><span class="line"></span><br><span class="line">cd <span class="regexp">/root/</span>springcloud/deployment</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5)alidev（build全部）如果mvn和java配置失败 请重新执行source /etc/profile</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev</span><br><span class="line"><span class="comment">#单个</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev EurekaServer</span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev configServer</span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev ServiceClient</span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev ServiceClientB</span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;buildDocker.sh &gt; buildDocker_bew.sh &amp;&amp; chmod +x *.sh &amp;&amp; ./buildDocker_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=aliyun_dev gateway</span><br><span class="line"></span><br><span class="line"><span class="comment">##--------------安装k8s master和k8s node ------------</span></span><br><span class="line"><span class="comment">#6)安装K8sMaster（soft目录下installk8sMaster.sh） 需要修改aliyun镜像仓库地址，用户户名和密码，k8smaster ip,k8s node ip</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh </span><br><span class="line"><span class="comment">#7)重新配置master</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh configMaster</span><br><span class="line"><span class="comment"># 8)检查 master 初始化结果</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9)获得 join命令参数 </span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"></span><br><span class="line"><span class="comment">#10)安装Node:( (确保master 状态为ready 正常再操作node))（soft目录下installk8sNode.sh）</span></span><br><span class="line"><span class="comment">#需要修改aliyun镜像仓库地址，用户户名和密码，k8smaster ip,k8s node ip</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sNode.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sNode.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sNode.sh_new.sh</span><br><span class="line"><span class="comment"># 11)只在 worker 节点执行 设置masterip 和apiserver.demo</span></span><br><span class="line">echo <span class="string">&quot;192.168.31.200 apiserver.demo&quot;</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12)执行第9步： kubeadm token create --print-join-command 命令的输出 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13)只在 master 节点执行 直至nodes ready状态 等待 3-10 分钟</span></span><br><span class="line">kubectl get nodes -o wide</span><br><span class="line"></span><br><span class="line"><span class="comment">#若一直没有ready失败则kubectl get pod -n kube-system pod是否是ready状态和running状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##14)在master安装Kubectl,helm</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh configKubectl</span><br><span class="line"></span><br><span class="line"><span class="comment">#15)安装ingress </span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh installIngress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 16)记下kubord token</span></span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJvYXJkIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Imt1Ym9hcmQtdXNlci10b2tlbi01OTk4ZiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJvYXJkLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjMjMzM2Y2Mi00OTdlLTQwNGUtYmRmOS1kMWMwNjg4OWQwZWEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3Vib2FyZDprdWJvYXJkLXVzZXIifQ.fGttYtIb3w6YrqYIrZodd7J0PXz5cCT8P7w7L_0V0ddCJY8gaEm-n5dTQurfigJuTcSUAzjJgHXAyp4sb-XZ8ma5jnnipZfW3543oiFo-gcbKwvVGPQYUqJ-UrCQlw_yW43iJ6Y7DzFPrVwfQ1ByfoUCDnEvDTLxG6yC3qNlzlVAsBMtreeUXqNl-xMIUAa-GQZL7gaddRiBQhmY96a67NFhqgiU8Lz_lv8NiQxAZT5ECDsoCl9-qzx7pm04I5W3tS2wPrew06Fqlpf0sxLWY__bd_SnTbFKlCGRA9_-h4uDZW9x3vn6FxfS-RT_o9Yd8GZYKr8I2P5cPZ8Xqx094w</span><br><span class="line"><span class="comment">#查看pod :kubectl get pod --all-namespaces </span></span><br><span class="line"><span class="comment"># host文件设置  192.168.31.200 kuboard.yanwen.com  （换成虚拟机主机ip）</span></span><br><span class="line"><span class="comment">#直至所有pod启动成功浏览器访问kuboard.yanwen.com 输入 &quot;脚本最打印后token&quot;</span></span><br><span class="line"><span class="comment">##--------------安装k8s master和k8s node ------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##----------------------------部署代码------------------------------ </span></span><br><span class="line"><span class="comment">#17）确保kubectl master node确保是否是readey</span></span><br><span class="line">kubectl get nodes -o wide</span><br><span class="line"><span class="comment">#代码master上传至： /root/springcloud/deployment</span></span><br><span class="line"><span class="comment">#18）执行部署</span></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh createSecret</span><br><span class="line"></span><br><span class="line">tr -d <span class="string">&#x27;\r&#x27;</span> &lt;<span class="regexp">/root/</span>soft<span class="regexp">/installk8sMaster.sh &gt; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh  &amp;&amp; chmod +x <span class="regexp">/root/</span>soft<span class="regexp">/*.sh &amp;&amp; /</span>root<span class="regexp">/soft/i</span>nstallk8sMaster.sh_new.sh deploy</span><br><span class="line"></span><br><span class="line"><span class="comment">#host设置：192.168.31.200  demodev.yanwen.com.cn eureka.intranet.local kuboard.yanwen.com demodev.intranet.local kuboard.yanwen.com （换成k8s master 节点 ip）</span></span><br><span class="line"></span><br><span class="line">demodev.yanwen.com.cn--ingress 配置 svc-nginx:<span class="number">80</span>, nginx访问http:<span class="regexp">//</span>svc-ing-gateway-gateway:<span class="number">6083</span></span><br><span class="line">demodev.intranet.local --ingress 配置http:<span class="regexp">//</span>svc-ing-gateway-gateway:<span class="number">6083</span></span><br><span class="line"></span><br><span class="line">eureka.intranet.local ingress 配置svc-ing-eureka-springclouddemoeureka:<span class="number">6080</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#19）测试连接：前往kuboard.yanwen.com 进行查看应用启动日志</span></span><br><span class="line"></span><br><span class="line">eureka: eureka.intranet.local </span><br><span class="line">gateway:</span><br><span class="line">http:<span class="regexp">//</span>demodev.yanwen.com.cn<span class="regexp">/searviceA/u</span>sers/<span class="number">111</span></span><br><span class="line">http:<span class="regexp">//</span>demodev.yanwen.com.cn<span class="regexp">/searviceB/u</span>sers/<span class="number">11</span></span><br><span class="line">内网</span><br><span class="line">http:<span class="regexp">//</span>demodev.intranet.local<span class="regexp">/searviceA/u</span>sers/<span class="number">111</span></span><br><span class="line">http:<span class="regexp">//</span>demodev.intranet.local<span class="regexp">/searviceB/u</span>sers/<span class="number">11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">扩容searviceA 待启动后 </span><br><span class="line">kubectl get deployment --all-namespaces</span><br><span class="line">kubectl scale --replicas=<span class="number">2</span> deployments/rs-serviceclient -n springclouddemo</span><br><span class="line"></span><br><span class="line">kubectl scale --replicas=<span class="number">1</span> deployments/rs-serviceclient -n springclouddemo</span><br><span class="line"></span><br><span class="line">在访问 测试ribbon负载均衡组件</span><br><span class="line">http:<span class="regexp">//</span>demodev.yanwen.com.cn<span class="regexp">/searviceB/u</span>sers/<span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">helm <span class="keyword">delete</span> --pruge configserver </span><br><span class="line">helm <span class="keyword">delete</span> --pruge gateway </span><br><span class="line">helm <span class="keyword">delete</span> --pruge nginx </span><br><span class="line">helm <span class="keyword">delete</span> --pruge serviceclient </span><br><span class="line">helm <span class="keyword">delete</span> --pruge serviceclientb </span><br><span class="line">helm <span class="keyword">delete</span> --pruge springclouddemoeureka</span><br><span class="line">helm <span class="keyword">delete</span> --pruge svcingress </span><br><span class="line"></span><br><span class="line"><span class="comment"># 单独部署：</span></span><br><span class="line">	  dir=<span class="regexp">/root/</span>springcloud/deployment</span><br><span class="line">	cd <span class="variable">$dir</span></span><br><span class="line"></span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh  &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh   &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo -Dname=springclouddemoeureka  eureka</span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh  &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh  &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=configserver configServer </span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh  &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh  &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=serviceclient ServiceClient</span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh   &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=serviceclientb ServiceClientB</span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh  &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh  &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=svcingress ingress</span><br><span class="line"></span><br><span class="line">	tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh   &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.0</span>.<span class="number">0</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=gateway gateway</span><br><span class="line">    tr -d <span class="string">&#x27;\r&#x27;</span> &lt;deploy.sh &gt; deploy_bew.sh  &amp;&amp; chmod +x <span class="variable">$dir</span><span class="regexp">/*.sh  &amp;&amp; ./</span>deploy_bew.sh  -Dver=<span class="number">1.16</span>.<span class="number">1</span> -Denv=ali_dev -Dnamespace=springclouddemo  -Dname=nginx nginx</span><br><span class="line">	------------------------------使用阿里云镜像仓库----</span><br></pre></td></tr></table></figure>
<ul>
<li>eureka.intranet.local</li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-22.png" alt="eureka.intranet.local "></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://demodev.yanwen.com.cn/searviceA/users/111">http://demodev.yanwen.com.cn/searviceA/users/111</a></li>
</ul>
<p><img src="/2022/09/03/%E5%BE%AE%E6%9C%8D/pasted-23.png" alt="demodev.yanwen.com.cn"></p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>微服务</p><p><span>文章作者：</span>peter.tan</p><p><span>发布时间：</span>2022-09-03</p><p><span>最后更新：</span>2022-09-05</p><p><span>原始链接：</span><a href="/2022/09/03/微服务/">https://petertanblog.github.io/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://petertanblog.github.io/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"></i></span></p><p><span>版权声明：</span>Copyright © 2022 Peter.tan</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://petertanblog.github.io/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" data-id="cl7m10mhq002it55kb74ce2lg" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACu0lEQVR42u3aQW4jMQwEwPz/01lgr9kdd5OS40P5FDj2jGoCSEyTX1/x6/vv6+fP+Sd/fut/7/x8JfddvfDw8PBGS28v/fO3z+/kd0zWkHweDw8P7zZvtsXnjPxIyB/f85rx8PDwPoGXLLcFP18zL9Dx8PDwPpM3CyOewfkRgoeHh/dpvCQI2EQSUXAwWs+xrAUPDw+vu+awAfZbP7+pv4eHh4e3bkQlzf58KW0kUa8TDw8P7wIvCV7bKLZ9v9306+/i4eHhXeDl7fwN5nmjz2PlPBTGw8PDeydvNuRUNKXyZY0yh7p+x8PDw5vvqMU//8m32uK4LfHrphceHh7emneqjJ7FtXlR3o4p4OHh4b2HN4sGNqV5+7BaPB4eHt4N3mrbXQ8E7JtwRZyBh4eHd4iX3GazWe/L9OTKq3EBPDw8vEVHKW9lbVr4eTScP/Toj4GHh4d3lJcPlW4aZu24VX7kvDiE8PDw8I7y2kI2v9k+2mjj4BdhBB4eHt4hXhsZzIrjNoyYxbvRABYeHh7eIV6ycc82/TaqaGPcCImHh4d3lNeGp/uNe7a5zx49Hh4e3m1eGw3sy+52mKBl4+Hh4d3jPRfEz8vKP9M2zzZHCx4eHt5tXnswJJv4LFao21rP8QceHh7eBd6snJ2NYbUFehtGvEDi4eHhXeY9X7RtcW1K9jz+eFFw4+Hh4R3lnToG8iucYheTEXh4eHgXeEVLflFA57FsPmj1IuzAw8PDO8r7Ll9tmTsbPpgNFvzjXnh4eHgXeO22m4cU7XEyC0fy1hoeHh7eWV47OLUfMsgXfaBFh4eHh3eNNyuC96FGW5q3RwgeHh7ep/HazXrYxIo/89+UGg8PD++XeG1zqx2Weo458rEDPDw8vPfwNht9+4D2d8nDETw8PLwbvFkDbBPIzg6bi10+PDw8vJT3BzqhnHGe9PFDAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/Kubernetes"><i class="fa fa-tag">Kubernetes</i></a><a href="/tags/微服务"><i class="fa fa-tag">微服务</i></a><a href="/tags/spring cloud"><i class="fa fa-tag">spring cloud</i></a><a href="/tags/docker"><i class="fa fa-tag">docker</i></a></div><div class="post-nav"><a class="pre" href="/2022/09/05/JVM/">JVM</a><a class="next" href="/2022/08/22/K8S%E7%9F%A5%E8%AF%86/">Kubernetes知识</a></div><script src="https://utteranc.es/client.js" repo="peterTanBlog/blog_comments" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/images/head.jpg"/></a><p>我喜欢计算编程,专注后端开发 性能调优 spring 框架 spring boot docker k8s</p><a class="info-icon" href="mailto:beityw@hotmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/peterTanBlog/" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Hexo-admin/" style="font-size: 15px;">Hexo admin</a> <a href="/tags/hexo-%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2/" style="font-size: 15px;">hexo 站内搜索</a> <a href="/tags/hexo-%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo 百度统计</a> <a href="/tags/hexo-google%E7%BB%9F%E8%AE%A1/" style="font-size: 15px;">hexo google统计</a> <a href="/tags/%E7%99%BE%E5%BA%A6%E6%94%B6%E5%BD%95hexo%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">百度收录hexo博客</a> <a href="/tags/google%E6%94%B6%E5%BD%95hexo-%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">google收录hexo 博客</a> <a href="/tags/maupassant-%E4%B8%BB%E9%A2%98/" style="font-size: 15px;">maupassant 主题</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/utterances-%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">utterances 评论插件</a> <a href="/tags/IDEA/" style="font-size: 15px;">IDEA</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/mysql%E9%87%8D%E7%BD%AEroot%E5%AF%86%E7%A0%81/" style="font-size: 15px;">mysql重置root密码</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9Root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改Root密码</a> <a href="/tags/Mysql-%E5%BC%80%E5%90%AF%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/" style="font-size: 15px;">Mysql 开启用户远程访问</a> <a href="/tags/Mysql-%E7%BB%BF%E8%89%B2%E7%89%88%E5%AE%89%E8%A3%85/" style="font-size: 15px;">Mysql 绿色版安装</a> <a href="/tags/Mysql%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81/" style="font-size: 15px;">Mysql修改root密码</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">微服务</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring cloud</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/09/05/JVM/">JVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/22/K8S%E7%9F%A5%E8%AF%86/">Kubernetes知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/21/Docker%E7%9F%A5%E8%AF%86/">Docker知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/21/Mac%E6%8A%80%E5%B7%A7/">Mac技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/18/IDEA%E6%8A%80%E5%B7%A7/">IDEA技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/18/Eclipse-%E6%8A%80%E5%B7%A7/">Eclipse 技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/16/mysql%E7%BB%BF%E8%89%B2%E7%89%88%E5%AE%89%E8%A3%85/">mysql绿色版安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/16/%E5%85%B3%E4%BA%8Emysql/">mysql重置root密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/10/Hexo-Admin/">Hexo Admin</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://smallwenzi.github.io" title="我的博客" target="_blank">我的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">perter blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>